
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lotof√°cil Prime Analytics</title>

<style>
  :root{

    --bg1:#0b0c10;
    --bg2:#050608;

    --card: rgba(26,26,28,.72);
    --surface: rgba(255,255,255,.045);
    --surface2: rgba(255,255,255,.07);

    --text:#f3f4f6;
    --muted: rgba(243,244,246,.84);
    --muted2: rgba(243,244,246,.62);


    --accent:#eab308;
    --accent2:#f5d67b;

    --yellow:var(--accent);
    --yellow2:var(--accent2);


    --orange:#caa34a;
    --red:#3f3f46; --red2:#52525b;

    --stroke: rgba(255,255,255,.12);
    --stroke2: rgba(255,255,255,.08);

    --shadow: 0 18px 60px rgba(0,0,0,.65);

    --glowGold: 0 0 0 1px rgba(234,179,8,.20), 0 18px 60px rgba(234,179,8,.12);
    --glowSoft: 0 0 0 1px rgba(255,255,255,.06), 0 18px 60px rgba(0,0,0,.55);


    --green:var(--accent); --green2:var(--accent2);
    --blue:var(--accent); --blue2:var(--accent2);
    --purple:var(--accent); --purple2:var(--accent2);
  }


  *{ -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
  body{
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important;
    font-size: 15.5px;
    line-height: 1.35;
  }
  h1,h2,h3{ letter-spacing:.2px; }
  .title{
    font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif !important;
    font-weight: 1000;
    letter-spacing: .6px;
  }
  .sub, .subtitle, .mini, .hint{ color: var(--muted2); }


  button, .btn, .btnGhost, .btnPrimary, .btnBlue, .btnGreen, .btnRed, .btnYellow, .btnOrange{
    border-radius:18px !important;
    font-weight:1000;
    letter-spacing:.2px;
    transition:.15s;
  }
  button:hover, .btn:hover, .btnGhost:hover, .btnPrimary:hover, .btnBlue:hover, .btnGreen:hover, .btnRed:hover, .btnYellow:hover, .btnOrange:hover{
    transform: translateY(-1px);
    filter: brightness(1.05);
  }
  button:active, .btn:active, .btnGhost:active, .btnPrimary:active, .btnBlue:active, .btnGreen:active, .btnRed:active, .btnYellow:active, .btnOrange:active{
    transform: translateY(0px);
    filter: brightness(.98);
  }

  .btnPrimary, .btnYellow{
    background: linear-gradient(180deg, rgba(250,204,21,.98), rgba(250,204,21,.78)) !important;
    color:#111 !important;
    border:1px solid rgba(250,204,21,.35) !important;
    box-shadow: 0 18px 55px rgba(250,204,21,.18);
  }
  .btnPrimary:hover, .btnYellow:hover{ box-shadow: 0 18px 70px rgba(250,204,21,.22); }

  .btnGhost, .btn, .btnBlue, .btnGreen, .btnOrange{
    background: rgba(0,0,0,.55) !important;
    border:1px solid rgba(255,255,255,.12) !important;
    color: var(--text) !important;
    box-shadow: 0 14px 40px rgba(0,0,0,.28);
  }

  .btnSmall{ padding:10px 14px !important; border-radius:16px !important; width:auto !important; }
  .btnWide{ width:100% !important; }

*{box-sizing:border-box;font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
  html,body{height:100%}
  body{
    margin:0;
    color:var(--text);
    background:
      radial-gradient(900px 620px at 18% 8%, rgba(255,255,255,.06), transparent 60%),
      radial-gradient(900px 620px at 82% 12%, rgba(255,255,255,.04), transparent 62%),
      radial-gradient(1100px 700px at 50% 0%, rgba(255,255,255,.05), transparent 58%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    min-height:100dvh;
    overflow-x:hidden;
  }

  .center{
    display:flex;align-items:center;justify-content:center;
    min-height:100dvh;padding:16px;
  }
  .wrap{max-width:1180px;margin:0 auto;padding:18px}


  .header{display:flex;justify-content:center;align-items:center;margin-bottom:14px}
  .title{
    font-size: clamp(22px, 5.8vw, 34px);
    font-weight:1000;
    margin:0;
    letter-spacing:.3px;
    text-align:center;
    line-height:1.12;
    color: var(--accent);
    text-transform: uppercase;
  }


  .chip{
    display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;
    background: rgba(0,0,0,.72);
    border:1px solid var(--stroke);
    color:var(--text);
    font-size:12px;font-weight:900;
    box-shadow: 0 10px 30px rgba(0,0,0,.25);
    white-space:nowrap;
  }
  .chip .dot{width:7px;height:7px;border-radius:999px;background:rgba(250,204,21,.95);display:inline-block}
  .card{
    background: linear-gradient(180deg, rgba(38,38,42,.75), rgba(20,20,22,.55));
    border:1px solid var(--stroke);
    border-radius:26px;
    padding:18px;
    box-shadow:var(--shadow);
    margin-bottom:14px;
    backdrop-filter: blur(10px);
    width:100%;
    max-width: none;
    margin-left:auto;margin-right:auto;
  }

  #loginWrap .card{max-width:520px}


  #app .card{max-width:none}

  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px}
  .box{
    background: linear-gradient(180deg, rgba(55,55,60,.28), rgba(20,20,22,.18));
    border:1px solid rgba(255,255,255,.11);
    border-radius:20px;
    padding:14px;
    box-shadow: var(--glowSoft);
  }


  .savedPack.on{
    background: rgba(255,255,255,.06) !important;
    border-color: rgba(250,204,21,.75) !important;
    color:#0b0b0b !important;
  }
  .savedPack.on b{ color:#0b0b0b !important; }
  .savedPack.on .mini{ color: rgba(0,0,0,.72) !important; }

.box p{margin:0;color:var(--text);font-size:13px;line-height:1.5}
  .mini{color:var(--muted);font-size:12px;margin-top:8px;line-height:1.45}
  .mini strong{color:var(--text)}

  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:stretch}
  .col{flex:1 1 240px;min-width:0}

  label{display:block;font-size:12px;color:var(--accent);font-weight:950;margin-bottom:6px;text-align:left}
  input, select{
    width:100%;
    max-width:100%;
    padding:14px 14px;
    border-radius:18px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.70);
    color:var(--text);
    outline:none;
  }
  input:focus, select:focus{
    border-color: rgba(250,204,21,.28);
    box-shadow: 0 0 0 3px rgba(255,255,255,.06);
  }
  input::placeholder{color:rgba(203,213,225,.65)}
  select{cursor:pointer}
  .btn{
    padding:12px 16px;
    border:3px solid #000;
    border-radius:18px;
    background: rgba(0,0,0,.52);
    color: var(--text);
    font-weight:1000;
    cursor:pointer;
    transition:.15s;
    box-shadow: 0 14px 40px rgba(0,0,0,.35);
    width:100%;
  }
  .btn:hover{filter:brightness(1.05);transform:translateY(-1px)}
  .btn:active{transform:translateY(0px);filter:brightness(.98)}
  .btn:disabled{opacity:.55;cursor:not-allowed;transform:none;box-shadow:none}
  .btnPrimary{background:linear-gradient(135deg,var(--yellow),var(--yellow2));box-shadow: var(--glowGold);color:#111111;border:1px solid rgba(250,204,21,.55)}
  .btnBlue{background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow: var(--glowGold);color:#111111;border:1px solid rgba(255,255,255,.28)}
  .btnPurple{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#111111;box-shadow: var(--glowGold);border:1px solid rgba(255,255,255,.28)}
  .btnDanger{background: linear-gradient(180deg, rgba(64,64,70,.45), rgba(20,20,22,.55)) !important;border: 1px solid rgba(255,255,255,.14) !important;color: var(--text) !important;box-shadow: 0 10px 26px rgba(0,0,0,.45) !important;}
  .btnGhost{
    background: rgba(255,255,255,.06) !important;
    border:1px solid rgba(255,255,255,.14) !important;
    color: rgba(255,255,255,.92) !important;
    box-shadow: 0 14px 40px rgba(0,0,0,.26);
    width:auto;
  }

  .status{display:none;margin-top:10px;padding:12px;border-radius:14px;background:rgba(56,189,248,.10);
          border:1px solid rgba(56,189,248,.22);color:#e6f8ff;font-size:13px;font-weight:950;}
  .bar{height:10px;border-radius:999px;overflow:hidden;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.08);margin-top:10px}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .2s ease}


  .view{display:none}
  .view.on{display:block}
  .topNav{
    display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;
    margin-bottom:10px;
  }
  .topNav .left{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .topNav .right{display:flex;gap:10px;flex-wrap:wrap;align-items:center}


  .actionGrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:14px;margin-top:12px}
  .actionCard{
    text-align:left;
    border:3px solid #000; /* BLACK PIANO */
    background:
      radial-gradient(700px 260px at 22% 0%, rgba(255,255,255,.06), transparent 60%),
      radial-gradient(700px 260px at 78% 0%, rgba(255,255,255,.05), transparent 62%),
      linear-gradient(180deg, rgba(38,38,42,.72), rgba(20,20,22,.52));
    border-radius:26px;
    padding:20px 22px;
    cursor:pointer;
    transition:.15s;
    position:relative;
    min-height:150px;
    box-shadow: 0 18px 55px rgba(0,0,0,.42);
    overflow:hidden;
  }
  .actionCard:hover{transform:translateY(-2px);background: var(--surface2);}
  .actionTitle{
    font-weight:1000;
    font-size:18px;
    margin:0 0 10px;
    color: var(--accent);
    letter-spacing:.25px;
  }
  .badge.premium{border-color:rgba(56,189,248,.30);background:rgba(56,189,248,.14);color:#e6f8ff}
  .badge.free{border-color:rgba(250,204,21,.35);background:rgba(255,255,255,.06);color:#fff2b0}


  .extraCard{
    border:3px solid rgba(250,204,21,.75);
    background: radial-gradient(900px 240px at 30% 20%, rgba(255,255,255,.06), transparent 60%),
                radial-gradient(900px 240px at 70% 20%, rgba(255,255,255,.05), transparent 60%),
                rgba(0,0,0,.82);
    box-shadow: var(--glowGold), 0 22px 70px rgba(0,0,0,.45);
    transform: translateZ(0);
  }
  .extraBadge{
    position:absolute;top:14px;right:14px;
    font-size:11px;font-weight:1000;
    padding:6px 10px;border-radius:999px;
    border:3px solid rgba(250,204,21,.75);
    background:rgba(255,255,255,.06);
    color:#fff2b0;
  }
  .extraHeadline{
    display:flex;align-items:center;gap:10px;flex-wrap:wrap;
    margin-bottom:6px
  }
  .extraHighlight{
    display:inline-flex;align-items:center;gap:8px;
    padding:6px 10px;border-radius:999px;
    border:3px solid rgba(250,204,21,.75);
    background:rgba(255,255,255,.06);
    color:#fff2b0;
    font-weight:1000;font-size:12px;
  }
  /* ====== ELITE (COMBO) ====== */
  .eliteCard{
    border:3px solid rgba(234,179,8,.55);
    background: radial-gradient(900px 240px at 30% 20%, rgba(255,255,255,.06), transparent 60%),
                radial-gradient(900px 240px at 70% 20%, rgba(255,255,255,.05), transparent 60%),
                rgba(0,0,0,.74);
    box-shadow: var(--glowGold), 0 22px 70px rgba(0,0,0,.40);
  }
  .eliteBadge{
    position:absolute;top:14px;right:14px;
    font-size:11px;font-weight:1000;
    padding:6px 10px;border-radius:999px;
    border:3px solid rgba(234,179,8,.55);
    background:rgba(255,255,255,.06);
    color:#fff2b0;
    letter-spacing:.35px;
  }



  .cartaoWrap{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px}

@media (max-width: 520px){
  .actionGrid{ grid-template-columns: 1fr; }
  .header{ margin-bottom: 10px; }
}

  .cartao{
    display:grid;grid-template-columns: repeat(5, 44px);
    gap:8px;justify-content:center;margin:10px 0 0;
  }
  .cel{
    width:44px;height:44px;border-radius:12px;
    display:flex;align-items:center;justify-content:center;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.70);
    color:var(--text);font-weight:1000;
  }
  .cel.on{background:rgba(0,0,0,.72);border:1px solid rgba(250,204,21,.38);color:var(--accent);box-shadow:0 12px 30px rgba(0,0,0,.25)}
  .cel.inv{background:rgba(0,0,0,.72);border:1px solid rgba(250,204,21,.28);color:var(--accent2);box-shadow:0 12px 30px rgba(0,0,0,.25)}
  .cel.tech{background:rgba(255,255,255,.06);border:1px solid rgba(250,204,21,.30);color:#fff2b0;box-shadow:0 12px 30px rgba(0,0,0,.25)}

  .numbers{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:10px 0 6px}
  .ball{
    width:44px;height:44px;border-radius:999px;display:flex;align-items:center;justify-content:center;
    background:rgba(0,0,0,.72);
    border:1px solid rgba(250,204,21,.28);
    color:var(--accent);font-weight:1000;letter-spacing:.4px;
    box-shadow:0 14px 34px rgba(0,0,0,.35);
  }
  .balls{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}

  .hr{height:1px;background:rgba(255,255,255,.10);margin:12px 0;border-radius:999px}


  .panelCheck{
    margin-top:12px;
    border:1px solid var(--stroke);
    background: var(--surface);
    border-radius:18px;
    padding:14px;
  }
  .panelCheck b{font-size:13px}


  .modalBack{display:none;position:fixed;inset:0;background:rgba(0,0,0,.62);backdrop-filter: blur(7px);
             align-items:center;justify-content:center;padding:16px;z-index:999}
  .modal{
    width:100%;
    max-width:980px;
    background: linear-gradient(180deg, rgba(12,10,7,.86), rgba(12,10,7,.62));
    border:3px solid #000;
    border-radius:20px;
    box-shadow:0 40px 120px rgba(0,0,0,.70);
    overflow:hidden;
  }
  .tip::after{
    content: attr(data-tip);
    position:absolute;
    left:0;
    top: calc(100% + 8px);
    min-width: 220px;
    max-width: 360px;
    padding:10px 12px;
    border-radius:12px;
    background:rgba(2,6,23,.92);
    border:1px solid rgba(255,255,255,.14);
    color:rgba(248,250,252,.95);
    box-shadow: 0 18px 55px rgba(0,0,0,.55);
    opacity:0;
    pointer-events:none;
    transform: translateY(-4px);
    transition: .12s ease;
    z-index: 9999;
    font-size: 12px;
    line-height: 1.35;
    white-space: normal;
  }
  .tip:hover::after{ opacity:1; transform: translateY(0); }
  .tip .q{opacity:.8}



@media (max-width: 520px){
  #loginWrap .row{
    flex-direction: column;
    gap: 10px;
  }
  #loginWrap .col{
    flex: 1 1 auto !important;
  }
}

.pickGrid{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;max-width:460px;margin-top:10px}
.pickCell{
  height:44px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.70);
  font-weight:1000;cursor:pointer;user-select:none;
}
.pickCell.sel{background:rgba(0,0,0,.72);border-color:rgba(250,204,21,.40);color:var(--accent);box-shadow:0 12px 30px rgba(0,0,0,.25)}
.pickCell.lock{opacity:.35;cursor:not-allowed}

.hit-11{ color:#38bdf8; font-weight:900; }
.hit-12{ color:#a78bfa; font-weight:900; }
.hit-13{ color:#facc15; font-weight:1000; }
.hit-14{ color:#fb923c; font-weight:1000; }
.hit-15{ color:#facc15; font-weight:1000; }

.lineTabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.lineBtn{
  padding:8px 10px;border-radius:12px;
  border:1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.70);
  color:var(--text);font-weight:1000;cursor:pointer
}
.lineBtn.on{border-color:rgba(56,189,248,.35);background:rgba(56,189,248,.12);color:#e6f8ff}
.slotRow{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.slot{
  min-width:52px;
  padding:8px 10px;border-radius:12px;
  border:1px dashed rgba(255,255,255,.18);
  background: rgba(0,0,0,.66);
  font-weight:1000;
}


  .btnPrimary{
    background: var(--yellow) !important;
    color:#111111 !important;
    border:1px solid rgba(250,204,21,.80) !important;
    box-shadow: var(--glowGold) !important;
  }


  @media (max-width:420px){
    .ball{ width:38px; height:38px; font-size:13px; }
    .numbers{ gap:6px; }
  }


  .swapCard{ margin-top: 10px; }
  .swapImgs{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap:12px;
    margin-top:12px;
    align-items:start;
  }
  .swapImgWrap{
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.66);
    border-radius:16px;
    padding:12px;
    text-align:center;
    overflow:visible;
  }
  .swapImgWrap b{ color: var(--yellow); display:block; margin-bottom:8px; }
  .swapImg{
    display:block;
    width:100%;
    max-width: 520px;
    height:auto;
    aspect-ratio: 5 / 6;
    object-fit: contain;
    margin: 0 auto;
    border-radius:14px;
    border:1px solid rgba(250,204,21,.22);
    background: rgba(0,0,0,.70);
    box-shadow: 0 18px 55px rgba(0,0,0,.38);
  }
  .swapRow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
  .swapMini{
    flex: 1 1 260px;
    border:1px solid rgba(255,255,255,.14);
    background: rgba(0,0,0,.66);
    border-radius:16px;
    padding:12px;
  }
  .swapMini b{ color: var(--yellow); }
  .swapGamesRow{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
    margin-top:12px;
    align-items:start;
  }
  @media (max-width: 900px){
    .swapGamesRow{ grid-template-columns: 1fr; }
  }

.p15-card{
  background: linear-gradient(180deg, rgba(0,0,0,.92), rgba(0,0,0,.78));
  border:3px solid rgba(250,204,21,.75);
  border-radius:18px;
  padding:14px;
  margin:16px auto;
  max-width:380px;
  box-shadow:
    0 0 0 1px rgba(250,204,21,.15),
    0 0 25px rgba(250,204,21,.08),
    0 18px 55px rgba(0,0,0,.65);
}

.p15CardsGrid{
  display:grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap:14px;
  align-items:start;
  margin-top:12px;
}
.p15CardsGrid .p15-card{
  max-width:none;
  width:100%;
  margin:0;
}
@media (max-width: 1100px){
  .p15CardsGrid{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (max-width: 720px){
  .p15CardsGrid{ grid-template-columns: 1fr; }
  .p15CardsGrid .p15-card{ max-width: 420px; margin: 0 auto; }
}

.p15-title{
  font-weight:1000;
  font-size:14px;
  color:var(--accent);
  margin-bottom:10px;
  text-align:center;
  letter-spacing:.3px;
}

.p15-metrics{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin-bottom:12px;
}

.p15-chip{
  background:rgba(0,0,0,.85);
  border:1px solid rgba(250,204,21,.25);
  padding:6px 8px;
  border-radius:14px;
  font-size:11px;
  font-weight:900;
  text-align:center;
  box-shadow: 0 0 12px rgba(250,204,21,.05);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.p15-numbers{
  display:flex;
  gap:6px;
  flex-wrap:wrap;
  justify-content:center;
  margin:8px 0 12px 0;
}

.p15-ball{
  width:32px;
  height:32px;
  border-radius:999px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.95);
  border:1px solid rgba(250,204,21,.55);
  color:var(--accent);
  font-weight:1000;
  font-size:11px;
  box-shadow: 0 0 10px rgba(250,204,21,.15);
}

.p15-section{
  font-size:12px;
  line-height:1.45;
  margin-bottom:10px;
  color:rgba(255,255,255,.92);
}

.p15-warning{
  background:rgba(0,0,0,.75);
  border:1px solid rgba(250,204,21,.25);
  padding:10px;
  border-radius:14px;
  font-size:11.5px;
  line-height:1.4;
  box-shadow: inset 0 0 12px rgba(250,204,21,.05);
}

@media (max-width:420px){
  .p15-card{ max-width:92vw; padding:12px; }
  .p15-ball{ width:28px; height:28px; font-size:10px; }
  .p15-chip{ font-size:10px; padding:6px; }
}


  .badge, .pill, .tag, .chip{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:7px 12px;
    border-radius:999px;
    font-size:12px;
    font-weight:1000;
    letter-spacing:.3px;
    border:3px solid #000;
    background: rgba(0,0,0,.55);
    color: rgba(255,255,255,.92);
  }
  .badge.yellow, .pill.yellow, .tag.yellow, .chip.yellow{
    background: rgba(255,255,255,.06);
    border-color: rgba(250,204,21,.35);
    color: var(--accent2);
  }
  .badge.premium, .pill.premium{
    background: rgba(255,255,255,.06);
    border-color: rgba(255,255,255,.14);
    color: rgba(255,255,255,.86);
  }
  .badge.extra, .pill.extra{
    background: rgba(251,146,60,.12);
    border-color: rgba(251,146,60,.30);
    color: rgba(255,255,255,.92);
  }


  .iconBox, .iconWrap{
    width:34px;height:34px;
    border-radius:12px;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    background: rgba(255,255,255,.06);
    border:1px solid rgba(250,204,21,.22);
    box-shadow: 0 12px 30px rgba(0,0,0,.25);
  }
  .iconBox svg, .iconWrap svg{ filter: drop-shadow(0 6px 12px rgba(0,0,0,.35)); }


  .badge{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:7px 12px;
    border-radius:999px;
    font-size:12px;
    font-weight:1000;
    letter-spacing:.35px;
    border:3px solid #000;
    background: rgba(0,0,0,.48);
    color: rgba(255,255,255,.92);
    backdrop-filter: blur(8px);
  }
  .badge.free{
    background: rgba(255,255,255,.06);
    border-color: rgba(250,204,21,.32);
    color: var(--accent2);
  }
  .badge.premium{
    background: rgba(255,255,255,.06);
    border-color: rgba(255,255,255,.14);
    color: rgba(255,255,255,.88);
  }
  .extraBadge{
    display:inline-flex;
    align-items:center;
    padding:7px 12px;
    border-radius:999px;
    font-size:12px;
    font-weight:1000;
    letter-spacing:.35px;
    background: rgba(251,146,60,.14);
    border:1px solid rgba(251,146,60,.30);
    color: rgba(255,255,255,.92);
  }

  .actionDesc{
    color: rgba(255,255,255,.80);
    font-size:14.5px;
    line-height:1.35;
  }


  .mini{line-height:1.4; letter-spacing:.15px}
  b{letter-spacing:.15px}
  .topNav button{min-height:44px}


  .btnGhost, .btn, .btnRed, .btnOrange, .btnBlue, .btnGreen, .btnYellow{
    background: linear-gradient(180deg, rgba(64,64,70,.45), rgba(20,20,22,.55)) !important;
    border: 1px solid rgba(255,255,255,.14) !important;
    color: var(--text) !important;
    box-shadow: 0 10px 26px rgba(0,0,0,.45);
  }
  .btnPrimary{
    background: linear-gradient(180deg, rgba(234,179,8,.95), rgba(202,163,74,.92)) !important;
    border: 1px solid rgba(0,0,0,.35) !important;
    color:#111827 !important;
    box-shadow: 0 14px 30px rgba(234,179,8,.18);
  }


  .table{width:100%; border-collapse:separate; border-spacing:0 10px}
  .table thead th{
    font-weight:950; letter-spacing:.35px;
    padding:10px 12px; text-transform:uppercase;
    color: rgba(243,244,246,.92);
  }
  .table tbody tr{
    background: linear-gradient(180deg, rgba(0,0,0,.22), rgba(0,0,0,.35));
    border:1px solid rgba(255,255,255,.10);
    box-shadow: 0 10px 22px rgba(0,0,0,.35);
  }
  .table tbody td{padding:12px 12px; font-weight:650; color: rgba(243,244,246,.92)}
  .table tbody tr td:first-child{border-top-left-radius:14px;border-bottom-left-radius:14px}
  .table tbody tr td:last-child{border-top-right-radius:14px;border-bottom-right-radius:14px}


  #p15Area .box{padding:18px}
  #p15Area .mini{font-size:14px}


  .primeStepHdr{display:flex;align-items:flex-start;justify-content:space-between;gap:12px}
  .primePill{
    display:inline-flex;align-items:center;gap:8px;
    padding:6px 12px;border-radius:999px;
    border:1px solid rgba(234,179,8,.55);
    background: rgba(0,0,0,.30);
    font-weight:950;color:rgba(243,244,246,.92)
  }
  .primeGrid2{display:grid;grid-template-columns:1.1fr .9fr;gap:14px}
  @media(max-width:920px){.primeGrid2{grid-template-columns:1fr}}
  .primePanel{
    background: linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,.40));
    border:1px solid rgba(255,255,255,.10);
    border-radius:22px;
    padding:14px;
  }
  .primePanelTitle{font-weight:950;letter-spacing:.25px;margin-bottom:10px}
  .primeDonutWrap{display:grid;grid-template-columns:220px 1fr;gap:14px;align-items:center}
  @media(max-width:720px){.primeDonutWrap{grid-template-columns:1fr}}
  .primeRowCard{
    background: linear-gradient(180deg, rgba(0,0,0,.26), rgba(0,0,0,.42));
    border:1px solid rgba(255,255,255,.10);
    border-radius:18px;
    padding:12px;
    margin:10px 0;
  

  }


  /* === ELITE MOTIVOS (PADR√ÉO ELITE AJUSTADO MOBILE) === */
.eliteMotives{
  margin-top:14px;
  background: linear-gradient(180deg, rgba(0,0,0,.25), rgba(0,0,0,.45));
  border:1px solid rgba(255,255,255,.10);
  border-radius:20px;
  padding:14px;
}

.eliteMotivesHdr{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:12px;
}

.eliteMotivesHdr b{
  color: var(--accent);
  font-size:13.5px;
  letter-spacing:.4px;
}

.eliteMotivesHdr span{
  color: rgba(255,255,255,.55);
  font-size:11px;
  font-weight:800;
}

.eliteMotivesGrid{
  display:flex;
  flex-direction:column;
  gap:10px;
}

.eliteMotivesRow{
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:12px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.55);
}

.eliteMotivesTag{
  font-size:11.5px;
  font-weight:950;
  color: rgba(255,255,255,.85);
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.12);
  border-radius:999px;
  padding:6px 10px;
  align-self:flex-start;
}

.eliteMotivesNums{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
}

.eliteMotivesNum{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  min-width:34px;
  height:30px;
  padding:0 10px;
  border-radius:999px;
  background: rgba(0,0,0,.85);
  border:1px solid rgba(234,179,8,.40);
  color: var(--accent);
  font-weight:1000;
  font-size:12px;
  letter-spacing:.3px;
}

/* ===== Desktop ajustado ===== */
@media (min-width: 721px){

  .eliteMotivesRow{
    flex-direction:row;
    align-items:center;
    justify-content:space-between;
  }

  .eliteMotivesNums{
    justify-content:flex-end;
  }

}

/* ===== Mobile refinado ===== */
@media (max-width: 720px){

  .eliteMotivesHdr span{
    display:none;
  }

  .eliteMotivesRow{
    padding:10px 12px;
  }

  .eliteMotivesNum{
    min-width:30px;
    height:26px;
    font-size:11px;
  }

}
  .primeBar{
    height:10px;border-radius:999px;overflow:hidden;
    background: rgba(255,255,255,.10);
    border:1px solid rgba(255,255,255,.10);
  }
  .primeBar > div{
    height:100%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    border-radius:999px;
  }


/* =========================
   15P ‚Ä¢ Jogos Salvos (LINHAS)
   ========================= */
.p15savedCard{padding:12px 14px}
.p15savedHead{display:flex;align-items:flex-end;justify-content:space-between;gap:10px;flex-wrap:wrap}
.p15savedTitle{font-weight:1000;font-size:14px;letter-spacing:.2px}
.p15savedSub{opacity:.9}
.p15savedLines{margin-top:10px;border-top:1px solid rgba(255,255,255,.06);padding-top:6px}
.p15lineRow{display:flex;align-items:center;gap:10px;padding:7px 0;border-bottom:1px solid rgba(255,255,255,.06)}
.p15lineRow:last-child{border-bottom:0}
.p15lineLabel{width:44px;font-weight:1000;opacity:.95}
.p15hits{min-width:44px;text-align:center;font-weight:1000;font-size:12px;border-radius:999px;
  padding:3px 8px;background:rgba(255, 215, 0, .10);border:1px solid rgba(255, 215, 0, .25)}
.p15nums{display:flex;flex-wrap:wrap;gap:6px}
.p15ball{display:inline-flex;align-items:center;justify-content:center;
  min-width:34px;height:26px;padding:0 8px;border-radius:10px;
  font-weight:900;font-size:12px;letter-spacing:.2px;
  background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.10)}
.p15ball.hit{background:rgba(34,197,94,.18);border-color:rgba(34,197,94,.55);color:#2efc7b}

@media (max-width:520px){
  .p15savedCard{padding:10px 10px}
  .p15lineLabel{width:38px}
  .p15hits{min-width:40px;padding:2px 7px}
  .p15ball{min-width:30px;height:24px;border-radius:9px;font-size:11px;padding:0 7px}
  .p15nums{gap:5px}
}

</style>
</head>

<body>

<!-- ================= FIREBASE SDKs (HTML PURO) ================= -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-functions-compat.js"></script>

<script>

const APP_NAME = "LOTOF√ÅCIL PRIME ANALYTICS";
const BUY_LINK = "https://pay.hotmart.com/O104148865Y?off=c4m0nezi";
const BUY_LINK_15P = "https://pay.hotmart.com/Y104149008G?off=eehchnv4";

const ADMIN_EMAIL = "admin@lotofacilprime.com";

function freeKey(uid){ return `lf_free_used_v1_${uid||"anon"}`; }


// (removido) sequ√™ncia antiga do motor do JOGO PRINCIPAL
</script>

<script>

const firebaseConfig = {
  apiKey: "AIzaSyCodYgkQG0TUaqCk1i-0QcSB8GIt0iWp8c",
  authDomain: "lotofacil-prime.firebaseapp.com",
  projectId: "lotofacil-prime",
  storageBucket: "lotofacil-prime.firebasestorage.app",
  messagingSenderId: "385524602679",
  appId: "1:385524602679:web:9760aeb30dcb835a962cb2"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const functions = firebase.app().functions("us-central1");
</script>

<!-- LOGIN -->
<div class="center" id="loginWrap">
  <div class="card">
    <div style="text-align:center">
      <div class="title" style="margin:0">üéØ <span id="appName1"></span></div>
      <div class="mini" style="margin-top:6px">
        Entre para acessar o painel. Premium libera as ferramentas principais.
      </div>
    </div>

    <div style="margin-top:12px" class="row">
      <div class="col">
        <label>Email</label>
        <input id="email" type="email" placeholder="seuemail@gmail.com" />
      </div>
      <div class="col">
        <label>Senha</label>
        <input id="senha" type="password" placeholder="sua senha" />
      </div>
    </div>

    <button id="btnEntrar" class="btn btnPrimary" type="button">Entrar / Criar conta</button>

    <button id="btnForgot" class="btn" type="button" style="margin-top:10px;background: rgba(0,0,0,.72);border:1px solid rgba(255,255,255,.14);color:var(--text);box-shadow:none">
      Esqueci minha senha
    </button>

    <div id="msgOk" class="status" style="display:none"></div>
    <div id="msgErr" class="status" style="display:none;background:rgba(251,113,133,.12);border:1px solid rgba(251,113,133,.28);color:#ffe7ec"></div>

    <div class="footerNote">Dica: use o mesmo email utilizado na compra Hotmart.</div>
  </div>
</div>

<!-- APP -->
<div class="wrap" id="app" style="display:none">
  <div class="header">
    <div class="title">üéØ <span id="appName2"></span></div>
  </div>

  <!-- PREMIUM GATE -->
  <div class="card" id="premiumGate" style="display:none">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>
        <div style="font-weight:1000;font-size:16px">üîí √Årea Premium</div>
        <div class="mini">
          No modo Free voc√™ pode gerar <b>1 vez</b> apenas no <b>Jogo Principal</b>.
          Para liberar <b>An√°lise</b>, <b>Invertida</b> e <b>T√©cnica Premiada</b>, ative o Premium.
        </div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn btnDanger" id="btnComprar" type="button">Comprar Premium</button>
        <button class="btn btnGhost" id="btnJaComprei" type="button">J√° comprei</button>
        <button class="btn btnGhost" id="btnSair" type="button">Sair</button>
      </div>
    </div>
  </div>

  <!-- EXTRA 15P UPSELL -->
  <div class="card" id="addon15Card" style="display:none">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>
        <div style="font-weight:1000;font-size:16px">‚ú® Recurso Extra: 15 pontos garantido</div>
        <div class="mini">
          Esse recurso √© um <b>EXTRA comprado separadamente</b> e abre uma tela pr√≥pria.
        </div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <button class="btn btnDanger" id="btnComprar15p" type="button">Comprar 15 pontos</button>
        <button class="btn btnGhost" id="btnAtivar15p" type="button">J√° comprei</button>
      </div>
    </div>
  </div>

      <!-- ===== TELAS ===== -->
  <div class="view on" id="viewHome">
    <div class="card">

      <!-- Linha superior: seletor + progresso -->
      <div class="row">
        <div class="col">
          <label>Quantidade de concursos para analisar</label>
          <select id="qtdConcursos">
            <option value="3">3 concursos</option>
            <option value="4">4 concursos(recomendado para PRINCIPAL)</option>
            <option value="5">5 concursos</option>
            <option value="6">6 concursos</option>
            <option value="7">7 concursos</option>
            <option value="12">12 concursos</option>
            <option value="15">15 concursos</option>
            <option value="20">20 concursos</option>
            <option value="30">30 concursos</option>
            <option value="50">50 concursos</option>
            <option value="75">75 concursos</option>
            <option value="100">100 concursos</option>
            </select>
          <div class="mini" style="margin-top:8px">
            Esta janela s√≥ serve para (JOGO PRINCIPAL E GERAR ANALISE).
          </div>
        </div>

        <div class="col">
          <label>Progresso</label>

          <div id="status" class="status">
            <div id="statusText">Carregando‚Ä¶</div>
            <div class="bar"><div id="barFill"></div></div>
          </div>

          <div class="mini">
            Se a an√°lise estiver pesada, use 10 ou 20 concursos.
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- Cards de a√ß√µes -->
      <div class="actionGrid">
<div class="actionCard" id="btnHomePrincipal" role="button" tabindex="0">
          <span class="badge free">FREE 1x</span>
          <p class="actionTitle">üéØ Jogo principal</p>
          <p class="actionDesc">JOGO PRINCIPAL/INVERTIDA/TECNICAS 1 E 2 (4JOGOS) . Voc√™ tamb√©m pode montar o seu jogo manualmente.</p>
        </div>

<div class="actionCard" id="btnHomeAnalise" role="button" tabindex="0">
          <span class="badge premium">PREMIUM</span>
          <p class="actionTitle">üìà Gerar an√°lise</p>
          <p class="actionDesc">Resumo PRIME do "SISTEMA PREDITIVO" do per√≠odo selecionado (sem jogo).</p>
        </div>


<div class="actionCard" id="btnHomeCreate" role="button" tabindex="0">
          <span class="badge premium">PREMIUM</span>
          <p class="actionTitle">üß© Criar seus jogos</p>
          <p class="actionDesc">Escolha suas dezenas e gere automaticamente: PRINCIPAL (4), ELITE (6) ou 15P (10). Sem explica√ß√µes ‚Ä¢ com bot√£o Salvar.</p>
        </div>

<div class="actionCard" id="btnHomeSaved" role="button" tabindex="0">
          <span class="badge premium">PREMIUM</span>
          <p class="actionTitle">üíæ Jogos salvos</p>
          <p class="actionDesc">
            Confira seus jogos salvos e veja quantos pontos faria.
          </p>
        </div>

<div class="actionCard eliteCard" id="btnHomeElite" role="button" tabindex="0">
          <span class="eliteBadge">COMBO</span>
          <p class="actionTitle">üíé JOGO ELITE</p>
          <p class="actionDesc">Gera 6 jogos exclusivos (padr√µes ELITE fixos).</p>
        </div>

<div class="actionCard extraCard" id="btnHome15p" role="button" tabindex="0">
          <span class="extraBadge">EXTRA</span>
          <div class="extraHeadline">
            <p class="actionTitle" style="margin:0">‚úÖ 15 pontos garantido</p>
            <span class="extraHighlight">ESTRAT√âGIA (10 JOGOS)</span>
          </div>
          <p class="actionDesc">5 LINHAS geram 10 jogos "EXCLUSIVOS".</p>
        </div>
</div>
    </div>

    <div class="card" id="resultadoHome">
      <div class="footerNote">Selecione a janela e escolha uma op√ß√£o acima.</div>
    </div>

    <div class="appFooter">
      <div class="chip" id="chipUser">
        <span class="dot"></span>
        <span id="chipText">‚Äî</span>
      </div>
    </div>
  </div>

  <!-- TELA: AN√ÅLISE -->
  <div class="view" id="viewAnalise">
    <div class="topNav">
      <div class="left">
        <button class="btn btnGhost" type="button" onclick="goView('viewHome')">‚¨Ö Voltar</button>
      </div>
      <div class="right">
        <button class="btn btnGhost" type="button" onclick="verConcursos()">üìÖ Ver concursos</button>
      </div>
    </div>

    <div class="card" id="analiseArea">
      <div class="footerNote">Clique em ‚ÄúGerar an√°lise‚Äù na tela principal.</div>
    </div>
  </div>

  
  <!-- TELA: CRIAR SEUS JOGOS (PREMIUM) -->
  <div class="view" id="viewCreateGames">
    <div class="topNav">
      <div class="left">
        <button class="btn btnGhost" type="button" onclick="goView('viewHome')">‚¨Ö Voltar</button>
      </div>
    </div>

    <div class="card">
      <div class="box">
        <b>üß© CRIAR SEUS JOGOS (PREMIUM)</b>
        <div class="mini" style="margin-top:8px">
          Escolha suas dezenas e gere automaticamente os jogos do m√≥dulo ‚Äî <b>sem explica√ß√µes</b>. Depois, clique em <b>Salvar</b>.
        </div>

        <div class="row" style="margin-top:12px">
          <div class="col">
            <button class="btn btnGhost btnWide" type="button" onclick="openCreateMode('principal')">üéØ Principal (4 jogos)</button>
          </div>
          <div class="col">
            <button class="btn btnPrimary btnWide" type="button" onclick="openCreateMode('elite')">üíé ELITE (6 jogos)</button>
          </div>
        </div>

        <div class="row" style="margin-top:10px">
          <div class="col">
            <button class="btn btnGhost btnWide" type="button" onclick="openCreateMode('p15')">‚úÖ 15P (10 jogos)</button>
          </div>
          <div class="col">
            <button class="btn btnGhost btnWide" type="button" onclick="clearCreate()">üßπ Limpar sele√ß√£o</button>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <div id="createArea">
        <div class="footerNote">Escolha uma op√ß√£o acima.</div>
      </div>
    </div>
  </div>

<!-- TELA: JOGO PRINCIPAL -->
  <div class="view" id="viewPrincipal">
    <div class="topNav">
      <div class="left">
        <button class="btn btnGhost" type="button" onclick="goView('viewHome')">‚¨Ö Voltar</button>
      </div>
      <div class="right">
        <button class="btn btnBlue" type="button" onclick="goView('viewInvertida'); gerarInvertida()">üîÑ Invertida</button>
        <button class="btn btnPurple" type="button" onclick="goView('viewTecnica'); gerarTecnicaPremiada()">üèÜ T√©cnica</button>
        <button class="btn btnGhost" id="btnVerificarGeradosFromPrincipal" type="button" style="display:none" onclick="goView('viewCheck')">‚úÖ Verificar jogos gerados</button>
      </div>
    </div>

    <div class="card" id="principalArea">
      <div class="footerNote">Clique em ‚ÄúJogo Principal‚Äù na tela principal.</div>
    </div>
  </div>

  <!-- TELA: INVERTIDA -->
  <div class="view" id="viewInvertida">
    <div class="topNav">
      <div class="left">
        <button class="btn btnGhost" type="button" onclick="goView('viewPrincipal')">‚¨Ö Voltar</button>
      </div>
      <div class="right">
        <button class="btn btnPurple" type="button" onclick="goView('viewTecnica'); gerarTecnicaPremiada()">üèÜ Ir para T√©cnica</button>
      </div>
    </div>

    <div class="card" id="invertidaArea">
      <div class="footerNote">Gere um Jogo Principal primeiro.</div>
    </div>
  </div>

  <!-- TELA: T√âCNICA PREMIADA -->
  <div class="view" id="viewTecnica">
    <div class="topNav">
      <div class="left">
        <button class="btn btnGhost" type="button" onclick="goView('viewPrincipal')">‚¨Ö Voltar</button>
      </div>
      <div class="right">
        <button class="btn btnBlue" type="button" onclick="goView('viewInvertida'); gerarInvertida()">üîÑ Ir para Invertida</button>
      </div>
    </div>

    <div class="card" id="tecnicaArea">
      <div class="footerNote">Gere um Jogo Principal primeiro.</div>
    </div>
  </div>

  <!-- TELA: CHECK -->
  <div class="view" id="viewCheck">
    <div class="topNav">
      <div class="left">
        <button class="btn btnGhost" type="button" onclick="goView('viewPrincipal')">‚¨Ö Voltar</button>
      </div>
      <div class="right">
        <button class="btn btnGhost" type="button" onclick="conferirGerados()">Conferir com √∫ltimo concurso</button>
      </div>
    </div>

    <div class="card" id="checkArea">
      <div class="footerNote">Gere Principal + Invertida + T√©cnica para liberar esta tela.</div>
    </div>
  </div>

  <!-- TELA: 15 PONTOS -->
  
  <!-- TELA: JOGO ELITE -->
  <div class="view" id="viewElite">
    <div class="topNav">
      <div class="left">
        <button class="btn btnGhost" type="button" onclick="goView('viewHome')">‚¨Ö Voltar</button>
      </div>
      <div class="right">
        <button class="btn btnGhost" type="button" onclick="verConcursos()">üìÖ Ver concursos</button>
      </div>
    </div>

    <div class="card">
      <div class="box">
        <b>üíé JOGO ELITE (6 jogos)</b>
        <div class="mini" style="margin-top:8px">
          Este m√≥dulo <b>sempre</b> usa os <b>√∫ltimos 4 concursos</b> para an√°lise/encaixe (padr√µes aprendidos no treino ELITE).
        </div>

        <div class="row" style="margin-top:12px">
          <div class="col">
            <button class="btn btnPrimary btnWide" type="button" onclick="gerarElite()">üöÄ Gerar ELITE (6 jogos)</button>
          </div>
          <div class="col">
            <button class="btn btnGhost btnWide" type="button" onclick="salvarElite()">üíæ Salvar ELITE</button>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <div id="eliteArea">
        <div class="footerNote">Clique em ‚ÄúGerar ELITE‚Äù para montar os 6 jogos.</div>
      </div>
    </div>
  </div>

<div class="view" id="view15p">
    <div class="topNav">
      <div class="left">
        <button class="btn btnGhost" type="button" onclick="goView('viewHome')">‚¨Ö Voltar</button>
      </div>
      <div class="right">
        <button class="btn btnPrimary" type="button" onclick="gerar15P()">Gerar an√°lise 15P</button>
      </div>
    </div>

    <div class="card" id="p15Area">
      <div class="footerNote">Clique em ‚ÄúGerar an√°lise 15P‚Äù. Essa tela exige o EXTRA ativado (via claims).</div>
    </div>
  </div>
<!-- =========================
   TELA: JOGOS SALVOS
========================= -->
<div class="view" id="viewSavedGames" onshow="renderJogosSalvosAoAbrir()">
  <div class="topNav">
    <div class="left">
      <button class="btn btnGhost" type="button" onclick="goView('viewHome')">‚¨Ö Voltar</button>
    </div>
  </div>

  <div class="card">
    <label>Conferir √∫ltimos concursos</label>
    <select id="savedCheckQtd">
  <option value="3">√öltimos 3</option>
  <option value="6">√öltimos 6</option>
  <option value="12" selected>√öltimos 12</option>
  <option value="20">√öltimos 20</option>
  <option value="30">√öltimos 30</option>
  <option value="50">√öltimos 50</option>
  <option value="75">√öltimos 75</option>
  <option value="100">√öltimos 100</option>
  </select>

<div id="savedPacksList" style="margin-top:14px"></div>

<button class="btn btnPrimary" style="margin-top:10px" onclick="checkSavedGames()">
  Conferir jogos
</button>

<div id="savedGamesResult" style="margin-top:14px"></div>
  </div>
</div>

  <div class="footerNote">Aviso: an√°lise estat√≠stica n√£o garante premia√ß√£o. Jogo respons√°vel ‚úÖ</div>
</div>

<!-- MODAL LISTA CONCURSOS -->
<div id="modalBack" class="modalBack">
  <div class="modal">
    <div class="modalHeader">
      <b>üìå Concursos analisados (datas + dezenas)</b>
      <button class="closeBtn" onclick="fecharModal()">Fechar</button>
    </div>
    <div class="modalBody">
      <div id="listaConcursos"></div>
    </div>
  </div>
</div>

<!-- MODAL GRAFICO BLOCOS -->
<div id="modalBlocosBack" class="modalBack">
  <div class="modal" style="max-width:560px">
    <div class="modalHeader">
      <b>üìä Gr√°fico de Blocos A‚ÄìE</b>
      <button class="closeBtn" onclick="fecharGraficoBlocos()">Fechar</button>
    </div>
    <div class="modalBody">
      <div id="graficoBlocosArea"></div>
      <div class="mini" style="margin-top:10px">
        Blocos: A(01‚Äì05), B(06‚Äì10), C(11‚Äì15), D(16‚Äì20), E(21‚Äì25).
      </div>
    </div>
  </div>
</div>

<script>

document.getElementById("appName1").textContent = APP_NAME;
document.getElementById("appName2").textContent = APP_NAME;

function bindCardKey(el){
  el.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" || e.key === " "){
      e.preventDefault();
      el.click();
    }
  });
}

function showOk(t){
  const a=document.getElementById("msgOk");
  a.style.display="block";
  a.textContent=t;
  document.getElementById("msgErr").style.display="none";
}
function showErr(t){
  const a=document.getElementById("msgErr");
  a.style.display="block";
  a.textContent=t;
  document.getElementById("msgOk").style.display="none";
}

function setStatus(on, text){
  const st=document.getElementById("status");
  document.getElementById("statusText").textContent = text || "";
  st.style.display = on ? "block" : "none";
  toggleProgressCol(); // ‚úÖ garante alinhamento no mobile
}
function toggleProgressCol(){
  const st = document.getElementById("status");
  if(!st) return;

  const col = st.closest(".col");
  if(!col) return;

  const isMobile = window.innerWidth <= 520;
  const statusVisible = (getComputedStyle(st).display !== "none");

  if(isMobile && !statusVisible){
    col.style.display = "none";
  }else{
    col.style.display = "block";
  }
}

window.addEventListener("resize", toggleProgressCol);
document.addEventListener("DOMContentLoaded", toggleProgressCol);

function setProgress(p){
  document.getElementById("barFill").style.width = Math.max(0, Math.min(100, p)) + "%";
}

function abrirModal(){ document.getElementById("modalBack").style.display="flex"; }
function fecharModal(){ document.getElementById("modalBack").style.display="none"; }
function fecharGraficoBlocos(){ document.getElementById("modalBlocosBack").style.display="none"; }


/* ===================== CRIAR SEUS JOGOS (PREMIUM) ===================== */

let createMode = "principal";
let createPick15 = new Set();
let createResult = null; // {tipo, principal?, invertida?, tecnica1?, tecnica2?, eliteGames?, p15Lines?, p15Games?}

function openCreateMode(mode){
  if(!access?.premium){
    alert("üîí Este recurso exige PREMIUM.");
    return;
  }
  createMode = mode || "principal";
  createResult = null;

  // para 15P, usamos as mesmas vars do m√≥dulo 15P
  if(createMode === "p15"){
    if(!linesUser15 || !Array.isArray(linesUser15) || linesUser15.length !== 5){
      linesUser15 = [[],[],[],[],[]];
      activeLine15 = 4;
    }
  }
  renderCreate();
  goView("viewCreateGames");
}

function clearCreate(){
  createPick15 = new Set();
  createResult = null;
  if(createMode === "p15"){
    linesUser15 = [[],[],[],[],[]];
    linesSystem15 = null;
    activeLine15 = 4;
  }
  renderCreate();
}

function _setFromPickToArray(){
  const arr = Array.from(createPick15).map(Number).filter(n=>n>=1 && n<=25);
  arr.sort((a,b)=>a-b);
  return arr;
}

function _ensure15(arr){
  // garante 15 √∫nicas dentro de 1..25 (fallback determin√≠stico)
  const used = new Set((arr||[]).map(Number).filter(n=>n>=1 && n<=25));
  const out = Array.from(used).slice(0,15);
  for(let n=1;n<=25 && out.length<15;n++){
    if(!used.has(n)){ used.add(n); out.push(n); }
  }
  out.sort((a,b)=>a-b);
  return out.slice(0,15);
}

function _remapGame(game, perm){
  const mapped = (game||[]).map(n=>remapPorPermutacao(n, perm));
  return _ensure15(mapped);
}

function renderPickGridAny(id, selectedSet, lockedSet){
  let html = `<div class="pickGrid" id="${id}">`;
  for(let n=1;n<=25;n++){
    const sel = selectedSet && selectedSet.has(n) ? " sel" : "";
    const lock = lockedSet && lockedSet.has(n) ? " lock" : "";
    html += `<div class="pickCell${sel}${lock}" data-n="${n}">${format2(n)}</div>`;
  }
  html += `</div>`;
  return html;
}


function _blockCounts(nums){
  const c = [0,0,0,0,0,0]; // 1..5
  (nums||[]).forEach(n=>{
    const b = blocoIndex(n);
    c[b] = (c[b]||0)+1;
  });
  return c;
}
function _complementOf(base){
  const s = new Set(base||[]);
  const out = [];
  for(let n=1;n<=25;n++) if(!s.has(n)) out.push(n);
  return out;
}
function _pickFromBlock(list, block, preferHigh=false){
  const items = list.filter(n=>blocoIndex(n)===block).sort((a,b)=>a-b);
  return preferHigh ? (items[items.length-1]||null) : (items[0]||null);
}
function _mutateFromBase(base, swaps, seed){
  // swaps = quantas dezenas ser√£o trocadas (remove/add)
  const b0 = _ensure15(base);
  if(swaps<=0) return b0.slice();

  const comp = _complementOf(b0);
  const out = b0.slice();

  for(let k=0;k<swaps;k++){
    // Recalcula contagens a cada troca para ficar est√°vel e diferente
    const counts = _blockCounts(out);

    // bloco mais cheio (remove) e mais vazio (add)
    const blocks = [1,2,3,4,5];
    const sortedByFull = blocks.slice().sort((a,b)=> (counts[b]-counts[a]) || (a-b));
    const sortedByEmpty = blocks.slice().sort((a,b)=> (counts[a]-counts[b]) || (a-b));

    // seed alterna quais blocos escolhemos primeiro para diversificar jogos
    const removeBlock = sortedByFull[(seed + k) % sortedByFull.length];
    const addBlock    = sortedByEmpty[(seed + 2*k) % sortedByEmpty.length];

    // remove: pega uma dezena do bloco mais cheio (preferindo alta para ser determin√≠stico)
    const toRemove = _pickFromBlock(out, removeBlock, true);
    if(toRemove!=null){
      const ix = out.indexOf(toRemove);
      if(ix>=0) out.splice(ix,1);
    }

    // add: pega uma dezena do complemento no bloco mais vazio (preferindo baixa)
    let toAdd = _pickFromBlock(comp, addBlock, false);
    if(toAdd==null){
      // fallback: menor do complemento que ainda n√£o est√° no jogo
      toAdd = comp.find(n=>!out.includes(n)) || null;
    }
    if(toAdd!=null && !out.includes(toAdd)) out.push(toAdd);

    // garante 15 e ordena
    while(out.length>15) out.pop();
    while(out.length<15){
      const fill = comp.find(n=>!out.includes(n));
      if(fill==null) break;
      out.push(fill);
    }
    out.sort((a,b)=>a-b);
  }
  return _ensure15(out);
}

function gerarCreatePrincipal(){
  const base = _setFromPickToArray();
  if(base.length !== 15) return alert("Selecione exatamente 15 dezenas.");

  // ‚úÖ Regra: manual cria o 1¬∫ jogo igual ao escolhido e os pr√≥ximos com ajustes
  const principal = _ensure15(base);
  let invertida = _mutateFromBase(principal, 1, 1);
  let tecnica1  = _mutateFromBase(principal, 2, 2);
  let tecnica2  = _mutateFromBase(principal, 2, 3);

  // Garantia: n√£o repetir (somente no manual)
  const seen = new Set([_uniqueKey(principal)]);
  function uniq(g, swaps, seed){
    let gg = g.slice();
    let key = _uniqueKey(gg);
    let tries = 0;
    while(seen.has(key) && tries<6){
      gg = _mutateFromBase(principal, swaps + tries, seed + tries);
      key = _uniqueKey(gg);
      tries++;
    }
    seen.add(key);
    return gg;
  }
  invertida = uniq(invertida, 1, 1);
  tecnica1  = uniq(tecnica1, 2, 2);
  tecnica2  = uniq(tecnica2, 2, 3);

  createResult = { tipo:"principal4", principal, invertida, tecnica1, tecnica2 };
  renderCreate();
}

function _uniqueKey(nums){ return (nums||[]).slice().sort((a,b)=>a-b).join("-"); }

function gerarCreateElite(){
  const base = _setFromPickToArray();
  if(base.length !== 15) return alert("Selecione exatamente 15 dezenas.");

  const principal = _ensure15(base);
  const games = [];
  const seen = new Set();

  // ‚úÖ 6 jogos com varia√ß√£o determin√≠stica (somente manual)
  const swapPlan = [0,1,1,2,2,3];
  for(let i=0;i<6;i++){
    let g = _mutateFromBase(principal, swapPlan[i], i+1);
    let key = _uniqueKey(g);
    let tries = 0;
    while(seen.has(key) && tries<8){
      g = _mutateFromBase(principal, swapPlan[i] + 1 + tries, (i+1) + tries);
      key = _uniqueKey(g);
      tries++;
    }
    seen.add(key);
    games.push({ nome:`ELITE ${i+1}`, dezenas:g });
  }

  createResult = { tipo:"elite6", games };
  renderCreate();
}

function gerarCreate15P(){
  if(!allLinesComplete(linesUser15)){
    return alert("Complete as 5 linhas com 5 dezenas cada.");
  }
  linesSystem15 = linesUser15.map(l=>l.slice()); // base do 15P manual
  const jogos = gerarJogos15P(linesSystem15);
  createResult = { tipo:"p15", lines: linesSystem15, jogos };
  renderCreate();
}

function salvarCreate(){
  if(!createResult) return alert("Gere os jogos primeiro.");

  if(createResult.tipo === "principal4"){
    lastPrincipalGame = createResult.principal.slice();
    lastInvertidaGame = createResult.invertida.slice();
    lastTecnicaGames = { g1: createResult.tecnica1.slice(), g2: createResult.tecnica2.slice() };
    salvarPacotePrincipal();
    return;
  }

  if(createResult.tipo === "elite6"){
    lastEliteGames = { ok:true, games: (createResult.games||[]).map(g=>({ nome:g.nome, dezenas:g.dezenas })) };
    salvarElite();
    return;
  }

  if(createResult.tipo === "p15"){
    // usa salvar15P existente (salva em jogos salvos)
    salvar15P();
    return;
  }
}

function renderCreate(){
  const area = document.getElementById("createArea");
  if(!area) return;

  const mode = createMode;

  const header = `
    <div class="box">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
        <b>${
          mode==="principal" ? "üéØ Criar PRINCIPAL (4 jogos)" :
          mode==="elite" ? "üíé Criar ELITE (6 jogos)" :
          "‚úÖ Criar 15P (10 jogos)"
        }</b>
        <span class="badge premium">PREMIUM</span>
      </div>
      <div class="mini" style="margin-top:8px">
        ${
          mode==="p15"
            ? "Monte 5 linhas de 5 dezenas. Depois clique em <b>Gerar 10 jogos</b>."
            : "Selecione <b>15 dezenas</b> no grid. Depois clique em <b>Gerar</b>."
        }
      </div>
    </div>
  `;

  let body = "";

  if(mode === "principal" || mode === "elite"){
    // grid de sele√ß√£o (15 dezenas)
    if(typeof renderPickGridAny === "function"){
      body += renderPickGridAny("createPick", createPick15);
    }else{
      body += "<div class='mini'>‚ö†Ô∏è Grid n√£o dispon√≠vel.</div>";
    }

    body += `
      <div style="margin-top:12px">
        <button class="btn btnPrimary btnWide" type="button"
          onclick="${mode==="principal" ? "gerarCreatePrincipal()" : "gerarCreateElite()"}">
          üöÄ Gerar jogos
        </button>
      </div>
    `;
  }

  if(mode === "p15"){
    // editor 15P (5 linhas)
    if(typeof renderLinhas15Editor === "function"){
      body += renderLinhas15Editor();
    }else{
      body += "<div class='mini'>‚ö†Ô∏è Editor 15P n√£o dispon√≠vel.</div>";
    }

    body += `
      <div style="margin-top:12px">
        <button class="btn btnPrimary btnWide" type="button" onclick="gerarCreate15P()">
          üöÄ Gerar 10 jogos
        </button>
      </div>
    `;
  }

  // resultado + salvar (se seu fluxo usa createResult)
  if(typeof createResult !== "undefined" && createResult){
    body += `
      <div style="margin-top:16px">
        <button class="btn btnBlue btnWide" type="button" onclick="salvarCreate()">
          üíæ Salvar
        </button>
      </div>
    `;
  }

  area.innerHTML = header + body;
}


function goView(id){
  document.querySelectorAll('.view').forEach(v => v.style.display='none');
  document.getElementById(id).style.display='block';

  if(id === 'viewSavedGames'){
    renderJogosSalvosAoAbrir();
    return;
  }

  if(id === 'viewPrincipal'){
    const el = document.getElementById("principalArea");
    const temMsg = el && /Gere um Jogo Principal/i.test(el.textContent||"");

    if(!lastPrincipalGame){
      if(!window.__autoGenLock){
        window.__autoGenLock = true;
        Promise.resolve().then(()=>acaoPrincipal()).finally(()=>{ window.__autoGenLock = false; });
      }
      return;
    }

    if(temMsg){
      const balls = lastPrincipalGame.map(n=>`<div class="ball">${format2(n)}</div>`).join("");
      el.innerHTML = `
        <div class="box">
          <b>üéØ Jogo Principal</b>
          <div class="numbers" style="justify-content:flex-start">${balls}</div>
        </div>
      `;
    }
    return;
  }

  if(id === 'viewInvertida'){
    if(access?.premium && lastPrincipalGame){
      gerarInvertida(true);
    }
    return;
  }

  if(id === 'viewTecnica'){
    if(access?.premium && lastPrincipalGame){
      gerarTecnicaPremiada(true);
    }
    return;
  }
}
</script>

<script>

let access = {
  email: "",
  uid: "",
  premium: false,
  addon15: false,
  addonElite: false,
  isAdmin: false
};

async function refreshClaims(force=false){
  const u = auth.currentUser;
  if(!u) return access;

  const token = await u.getIdTokenResult(!!force);
  const email = (u.email || "").toLowerCase();
  const isAdmin = email === String(ADMIN_EMAIL).toLowerCase();

  const premium = !!token.claims.premium || isAdmin;
  const addon15 = !!token.claims.addon15 || isAdmin;
  const addonElite = !!token.claims.addonElite || !!token.claims.elite || !!token.claims.combo || isAdmin;

  access = { email, uid: u.uid, premium, addon15, addonElite, isAdmin };
  updateChip();
  aplicarAcessos();
  return access;
}

function updateChip(){
  const plan = access.isAdmin ? "üõ°Ô∏è Admin" : (access.premium ? "üëë Premium" : "üë§ Free");
  const extra = (access.addon15 || access.isAdmin) ? " ‚Ä¢ ‚úÖ 15P" : "";
  const extraElite = (access.addonElite || access.isAdmin) ? " ‚Ä¢ üíé ELITE" : "";
  const chipTextEl = document.getElementById("chipText");
  if(chipTextEl) chipTextEl.textContent = `${plan} ‚Ä¢ ${access.email || "‚Äî"}${extra}${extraElite}`;
}

function isFreeUsed(){
  if(!access.uid) return false;
  return localStorage.getItem(freeKey(access.uid)) === "1";
}
function markFreeUsed(){
  if(!access.uid) return;
  localStorage.setItem(freeKey(access.uid), "1");
}

function setCardEnabled(el, enabled, onClick, msg){
  if(!el) return;
  el.classList.toggle("disabled", !enabled);
  el.onclick = enabled ? onClick : ()=>alert(msg);
}

function aplicarAcessos(){
  const can15p = ((access.premium && access.addon15) || access.isAdmin);
  const canElite = ((access.premium && access.addonElite) || access.isAdmin);

  const premiumGate = document.getElementById("premiumGate");
  if(premiumGate) premiumGate.style.display = access.premium ? "none" : "block";

  const addon15Card = document.getElementById("addon15Card");
  if(addon15Card) addon15Card.style.display = (!access.isAdmin && !can15p) ? "block" : "none";

  const btnAnalise  = document.getElementById("btnHomeAnalise");
  const btnPrincipal= document.getElementById("btnHomePrincipal");
  const btnInvertida= document.getElementById("btnHomeInvertida");
  const btnTecnica  = document.getElementById("btnHomeTecnica");
  const btn15       = document.getElementById("btnHome15p");
  const btnElite    = document.getElementById("btnHomeElite");
  const btnCreate  = document.getElementById("btnHomeCreate");

setCardEnabled(btnAnalise, access.premium, acaoAnalise, "üîí Gerar an√°lise exige Premium.");

  setCardEnabled(btnCreate, access.premium, ()=>openCreateMode("principal"), "üîí Criar seus jogos exige Premium.");

  setCardEnabled(btnInvertida, access.premium, ()=>{
    goView("viewInvertida"); gerarInvertida();
  }, "üîí Invertida exige Premium.");

  setCardEnabled(btnTecnica, access.premium, ()=>{
    goView("viewTecnica"); gerarTecnicaPremiada();
  }, "üîí T√©cnica premiada exige Premium.");

  // üíé ELITE (somente COMBO)
  setCardEnabled(btnElite, canElite, ()=>{ goView("viewElite"); }, "üîí O recurso 'JOGO ELITE' est√° dispon√≠vel somente no pacote COMBO.");

  if(!access.premium && isFreeUsed()){
    btnPrincipal?.classList.add("disabled");
    if(btnPrincipal) btnPrincipal.onclick = ()=>alert("üîí Voc√™ j√° usou a gera√ß√£o gr√°tis. Para liberar, ative o Premium.");
  }else{
    btnPrincipal?.classList.remove("disabled");
    if(btnPrincipal) btnPrincipal.onclick = ()=>acaoPrincipal();
  }

  if(!can15p){
    btn15?.classList.add("disabled");
    if(btn15) btn15.onclick = ()=>alert("üîí O recurso '15 pontos garantido' √© um EXTRA comprado separadamente (libera via claims).");
  }else{
    btn15?.classList.remove("disabled");
    if(btn15) btn15.onclick = ()=>{ goView("view15p"); };
  }
}

function abrirApp(){
  document.getElementById("loginWrap").style.display="none";
  document.getElementById("app").style.display="block";
  goView("viewHome");
}

function fecharApp(){
  document.getElementById("loginWrap").style.display="flex";
  document.getElementById("app").style.display="none";
}

async function entrar(){
  const e=(document.getElementById("email").value||"").trim().toLowerCase();
  const s=(document.getElementById("senha").value||"");
  if(!e || !s){ showErr("Digite email e senha."); return; }

  const btn = document.getElementById("btnEntrar");
  btn.disabled = true;

  try{
    await auth.signInWithEmailAndPassword(e,s);
    showOk("Bem-vindo! Carregando seu acesso‚Ä¶");
  }catch(err){
    try{
      await auth.createUserWithEmailAndPassword(e,s);
      showOk("Conta criada ‚úÖ Carregando seu acesso‚Ä¶");
    }catch(e2){
      showErr(e2?.message || "Falha no login.");
    }
  }finally{
    btn.disabled = false;
  }
}

async function forgotPassword(){
  const e=(document.getElementById("email").value||"").trim().toLowerCase();
  if(!e) return showErr("Digite seu email para recuperar a senha.");
  try{
    await auth.sendPasswordResetEmail(e);
    showOk("‚úÖ Email de recupera√ß√£o enviado. Verifique sua caixa de entrada.");
  }catch(err){
    showErr(err?.message || "N√£o foi poss√≠vel enviar o email de recupera√ß√£o.");
  }
}

function sair(){ auth.signOut(); }

function comprarPremium(){ window.open(BUY_LINK, "_blank"); }
function comprar15p(){ window.open(BUY_LINK_15P, "_blank"); }

async function ativarComCodigo(){
  try{
    if(!auth.currentUser){
      alert("Voc√™ precisa estar logado.");
      return;
    }
    const code = prompt("Cole aqui seu C√ìDIGO de ativa√ß√£o (ex: PRIME-0001):");
    if(!code) return;

    showOk("Ativando c√≥digo‚Ä¶");
    const redeemCode = functions.httpsCallable("redeemCode");
    await redeemCode({ code: code.trim() });

    await refreshClaims(true);

    if(access.premium || access.addon15 || access.isAdmin){
      showOk("‚úÖ C√≥digo ativado! Seus acessos foram atualizados.");
    }else{
      showOk("‚úÖ C√≥digo enviado! Se n√£o liberar na hora, saia e entre novamente.");
    }
  }catch(err){
    console.log(err);
    showErr("‚ùå Erro ao ativar: " + (err?.message || err));
  }
}

async function jaComprei(){ await ativarComCodigo(); }
async function jaComprei15p(){ await ativarComCodigo(); }

auth.onAuthStateChanged(async (user)=>{
  if(!user){
    access = { email:"", uid:"", premium:false, addon15:false, addonElite:false, isAdmin:false };
    fecharApp();
    return;
  }
  abrirApp();
  await refreshClaims(true);
});
</script>

<script>

function format2(n){ return String(n).padStart(2,"0"); }

function toNum(d){ return Number(String(d).replace(/^0+/,"")) || Number(d); }
function sortNum(arr){ return arr.slice().sort((a,b)=>a-b); }

function getDezenas(c){
  const arr = (c && (c.dezenas || c.numeros || c.dezenasSorteadas)) || [];
  return (arr || []).map(toNum).filter(n=>n>=1 && n<=25);
}

function calcularFrequencias(concursos){
  const freq={}; for(let i=1;i<=25;i++) freq[i]=0;
  concursos.forEach(c=>{
    (c.dezenas||[]).forEach(d=>{
      const n=toNum(d);
      if(n>=1 && n<=25) freq[n]+=1;
    });
  });
  return freq;
}
function ordenarPorFreq(freq){
  return Object.entries(freq).map(([k,v])=>({dez:Number(k), f:v})).sort((a,b)=>b.f-a.f);
}
function contarParesImpares(jogo){
  const pares = jogo.filter(n=>n%2===0).length;
  return {pares, impares: jogo.length - pares};
}
function somaDezenas(jogo){ return jogo.reduce((a,b)=>a+b,0); }
function contarSequencias(jogo){
  let maxLen=1, curLen=0, prev=null;
  const sorted = sortNum(jogo);
  for(const n of sorted){
    if(prev!==null && n===prev+1){ curLen++; }
    else { curLen=1; }
    if(curLen>maxLen) maxLen=curLen;
    prev=n;
  }
  return { temSequencia: maxLen>=2, maxLen };
}
function distribuicaoBlocos(jogo){
  const b={A:0,B:0,C:0,D:0,E:0};
  jogo.forEach(n=>{
    if(n>=1 && n<=5) b.A++;
    else if(n>=6 && n<=10) b.B++;
    else if(n>=11 && n<=15) b.C++;
    else if(n>=16 && n<=20) b.D++;
    else if(n>=21 && n<=25) b.E++;
  });
  return b;
}
function repetidasDoUltimo(jogo, ultimoDezenas){
  const setUlt = new Set((ultimoDezenas||[]).map(toNum));
  return sortNum(jogo.filter(n=>setUlt.has(n)));
}

function classificarDezenas(freq, jogo){
  const ord = ordenarPorFreq(freq);
  const rank={}; ord.forEach((x,i)=>rank[x.dez]=i+1);
  const hot=[], warm=[], cold=[];
  jogo.forEach(n=>{
    const r=rank[n]||999;
    if(r<=8) hot.push(n);
    else if(r<=17) warm.push(n);
    else cold.push(n);
  });
  return {hot:sortNum(hot), warm:sortNum(warm), cold:sortNum(cold), rank};
}

function countGroupTogetherInWindow(group, concursos){
  const gset = new Set(group.map(Number));
  let count = 0;
  for(const c of (concursos || [])){
    const setC = new Set((c.dezenas||[]).map(toNum));
    let ok = true;
    for(const n of gset){
      if(!setC.has(n)){ ok=false; break; }
    }
    if(ok) count++;
  }
  return count;
}

function combosK(arr, k){
  const res = [];
  function rec(start, path){
    if(path.length === k){ res.push(path.slice()); return; }
    for(let i=start;i<arr.length;i++){
      path.push(arr[i]);
      rec(i+1, path);
      path.pop();
    }
  }
  rec(0, []);
  return res;
}

function getTop10FreqList(freq){
  return ordenarPorFreq(freq).slice(0,10).map(x=>x.dez);
}

function getTop10AtrasadasList(modern){
  const arr = [];
  for(let d=1; d<=25; d++){
    arr.push({ dez:d, gap:Number(modern?.gap?.[d] ?? 0) });
  }
  arr.sort((a,b)=>b.gap-a.gap);
  return arr.slice(0,10).map(x=>x.dez);
}

function calcModernMetrics(concursos){
  const n = concursos.length;
  const freq = Array(26).fill(0);
  const decay = Array(26).fill(0);
  const recent10 = Array(26).fill(0);
  const lastSeen = Array(26).fill(-1);

  const DECAY = 0.92; // peso para rec√™ncia (mais novo = mais peso)
  for(let i=0;i<n;i++){
    const nums=(concursos[i].dezenas||[]).map(toNum).filter(x=>x>=1 && x<=25);
    const w = Math.pow(DECAY, (n-1-i)); // √∫ltimo concurso = w=1
    nums.forEach(x=>{
      freq[x] += 1;
      decay[x] += w;
      lastSeen[x] = i;
      if(i >= n-10) recent10[x] += 1;
    });
  }

  const gap = Array(26).fill(999);
  for(let x=1;x<=25;x++){
    gap[x] = (lastSeen[x]===-1) ? n : (n-1-lastSeen[x]);
  }

  const trend = Array(26).fill(0);
  for(let x=1;x<=25;x++){
    const baseRate = freq[x] / Math.max(1,n);
    const recRate = recent10[x] / Math.max(1, Math.min(10,n));
    trend[x] = (recRate - baseRate);
  }

  return { n, freq, decay, recent10, gap, trend };
}

</script>

<script>

const TRAIN_FIXED = [
  { concurso:3592, dezenas:[1,4,5,6,7,9,12,13,17,18,20,21,22,23,25] },
  { concurso:3593, dezenas:[1,3,4,6,7,8,9,10,12,15,18,19,23,24,25] },
  { concurso:3594, dezenas:[1,2,4,5,7,8,9,11,14,15,18,20,21,23,24] },
  { concurso:3595, dezenas:[1,2,4,5,6,8,10,12,13,15,16,20,21,22,25] },
  { concurso:3596, dezenas:[1,2,3,4,5,6,7,8,14,15,16,18,20,21,22] },
  { concurso:3597, dezenas:[1,4,5,7,10,11,13,14,15,16,19,20,21,23,25] },
  { concurso:3598, dezenas:[1,3,4,5,6,7,8,9,11,16,18,21,22,23,24] },
  { concurso:3599, dezenas:[1,4,6,7,8,9,11,12,13,16,19,20,21,23,24] },
  { concurso:3600, dezenas:[3,4,5,6,7,8,9,11,12,16,17,20,21,22,25] },
  { concurso:3601, dezenas:[2,3,4,6,7,8,9,11,16,17,20,21,23,24,25] },
  { concurso:3602, dezenas:[1,2,3,4,5,6,8,9,15,18,19,20,22,23,24] },
  { concurso:3603, dezenas:[2,4,5,9,10,11,12,14,15,17,19,20,21,22,24] },
  { concurso:3604, dezenas:[1,2,3,6,7,8,11,13,15,16,19,21,22,23,24] },
  { concurso:3605, dezenas:[1,3,4,7,10,12,13,14,19,20,21,22,23,24,25] },
  { concurso:3606, dezenas:[2,3,6,7,9,11,12,14,15,17,19,20,21,23,24] },
  { concurso:3607, dezenas:[1,2,4,5,6,8,9,13,14,15,16,18,19,20,23] },
  { concurso:3608, dezenas:[2,5,6,8,9,11,14,16,17,18,19,20,22,23,25] },
  { concurso:3609, dezenas:[2,5,6,8,9,10,11,12,13,17,19,20,22,24,25] },
  { concurso:3610, dezenas:[1,3,5,7,8,10,13,14,17,20,21,22,23,24,25] },
  { concurso:3611, dezenas:[1,2,3,4,5,6,10,11,12,14,15,17,18,19,25] },
  { concurso:3612, dezenas:[4,6,8,9,11,14,15,16,17,18,19,20,21,22,25] },
  { concurso:3613, dezenas:[1,3,4,7,9,10,11,12,15,16,18,20,21,22,23] },
].map(x=>({ ...x, dezenas: x.dezenas.slice().sort((a,b)=>a-b) }));

const ALL_25 = Array.from({length:25}, (_,i)=>i+1);
const LETTERS_DRAWN = "ABCDEFGHIJKLMNO".split("");
const LETTERS_OUT   = "PQRSTUVWXYZ".split(""); // P..Y (10 letras)

function _isPrime(n){
  return n===2||n===3||n===5||n===7||n===11||n===13||n===17||n===19||n===23;
}
function _blockAE(n){
  if(n<=5) return "A";
  if(n<=10) return "B";
  if(n<=15) return "C";
  if(n<=20) return "D";
  return "E";
}
function _row(n){ return Math.floor((n-1)/5)+1; }     // 1..5
function _col(n){ return ((n-1)%5)+1; }               // 1..5
function _set(arr){ return new Set((arr||[]).map(Number)); }

function _gapClassInPrev4(num, prev4Draws){
  const s1=_set(prev4Draws[0]), s2=_set(prev4Draws[1]), s3=_set(prev4Draws[2]), s4=_set(prev4Draws[3]);
  if(s1.has(num)) return "R";
  if(s2.has(num)) return "G2";
  if(s3.has(num)) return "G3";
  if(s4.has(num)) return "G4";
  return "G4";
}
function _countInPrev4(num, prev4Draws){
  let c=0;
  for(const d of prev4Draws) if(_set(d).has(num)) c++;
  return c;
}

function _mode(arr){
  const m=new Map();
  for(const x of arr) m.set(x,(m.get(x)||0)+1);
  let best=null, bestc=-1;
  for(const [k,v] of m.entries()){
    if(v>bestc || (v===bestc && String(k)<String(best))){ best=k; bestc=v; }
  }
  return best;
}

let __TRAIN_PROFILES = null;

function trainFixedProfiles(){
  if(__TRAIN_PROFILES) return __TRAIN_PROFILES;

  const usable = [];
  for(let i=4;i<TRAIN_FIXED.length;i++){
    const cur = TRAIN_FIXED[i];
    const prev4 = [
      TRAIN_FIXED[i-1].dezenas,
      TRAIN_FIXED[i-2].dezenas,
      TRAIN_FIXED[i-3].dezenas,
      TRAIN_FIXED[i-4].dezenas
    ];
    usable.push({ cur, prev4 });
  }

  function buildLetterProfile(isDrawn, idx){ // idx = 0..14 (A..O) ou 0..9 (P..Y)
    const gapC=[], par=[], prime=[], bloco=[], r=[], c=[], occ=[];
    for(const u of usable){
      const setCur = _set(u.cur.dezenas);
      const drawn = u.cur.dezenas.slice(); // j√° ordenadas
      const out = ALL_25.filter(n=>!setCur.has(n));
      const n = isDrawn ? drawn[idx] : out[idx];

      gapC.push(_gapClassInPrev4(n, u.prev4));
      par.push(n%2===0 ? "PAR" : "IMPAR");
      prime.push(_isPrime(n) ? "PRIMO" : "NAO_PRIMO");
      bloco.push(_blockAE(n));
      r.push(_row(n));
      c.push(_col(n));
      occ.push(_countInPrev4(n, u.prev4)); // 0..4
    }

    return {
      gapClass: _mode(gapC),
      parity: _mode(par),
      prime: _mode(prime),
      block: _mode(bloco),
      row: Number(_mode(r)),
      col: Number(_mode(c)),
      occ: Number(_mode(occ))
    };
  }

  const drawnProfiles = {};
  LETTERS_DRAWN.forEach((L,idx)=> drawnProfiles[L] = buildLetterProfile(true, idx));

  const outProfiles = {};
  LETTERS_OUT.forEach((L,idx)=> outProfiles[L] = buildLetterProfile(false, idx));

  __TRAIN_PROFILES = { drawn: drawnProfiles, out: outProfiles };
  return __TRAIN_PROFILES;
}

function _featuresNow(num, prev4Draws){
  return {
    gapClass: _gapClassInPrev4(num, prev4Draws),
    parity: num%2===0 ? "PAR" : "IMPAR",
    prime: _isPrime(num) ? "PRIMO" : "NAO_PRIMO",
    block: _blockAE(num),
    row: _row(num),
    col: _col(num),
    occ: _countInPrev4(num, prev4Draws)
  };
}

function _scoreMatch(feat, prof){
  let s=0;
  if(feat.gapClass === prof.gapClass) s+=6;
  if(feat.parity   === prof.parity)   s+=2;
  if(feat.prime    === prof.prime)    s+=1;
  if(feat.block    === prof.block)    s+=2;
  if(feat.row      === prof.row)      s+=1;
  if(feat.col      === prof.col)      s+=1;
  s += Math.max(0, 2 - Math.abs((feat.occ||0) - (prof.occ||0)));
  return s;
}

function _rankCandidatesForProfile(candidates, usedSet, prev4Draws, prof, avoidCounts, penalty=0.9, tpl=null, cur=null){
  const pen = (typeof penalty === "number") ? penalty : 0.9;
  const scored = [];
  for(const n of candidates){
    if(usedSet.has(n)) continue;
    const feat = _featuresNow(n, prev4Draws);
    let sc = _scoreMatch(feat, prof);

    const usedTimes = avoidCounts && avoidCounts[n] ? avoidCounts[n] : 0;
    sc = sc - usedTimes * pen;

    scored.push({ n, sc, usedTimes });
  }
  scored.sort((a,b)=>{
    if(b.sc !== a.sc) return b.sc - a.sc;
    return a.n - b.n; // determin√≠stico
  });
  return scored;
}


function _pickVariantForProfile(candidates, usedSet, prev4Draws, prof, variantIndex, avoidCounts, penalty=0.9, tpl=null, cur=null){
  const ranked = _rankCandidatesForProfile(candidates, usedSet, prev4Draws, prof, avoidCounts, penalty, tpl, cur);
  if(!ranked.length) return null;

  const v = Math.max(0, Number(variantIndex)||0);

  // ‚úÖ Altern√¢ncia determin√≠stica:
  // - tenta usar a op√ß√£o "v" (0..3) da letra
  // - mas evita reutilizar dezenas j√° muito usadas nos jogos anteriores (avoidCounts)
  // - e respeita o template de conjunto (blocos/paridade) daquele jogo
  let chosen = null;

  // 1) procura a partir do √≠ndice v uma dezena com reutiliza√ß√£o <= v
  for(let i=v; i<ranked.length; i++){
    const it = ranked[i];
    if((it.usedTimes||0) <= v){
      chosen = it;
      break;
    }
  }

  // 2) se n√£o achou, cai para o √≠ndice v (se existir)
  if(!chosen){
    const idx = Math.min(v, ranked.length-1);
    chosen = ranked[idx];
  }

  // 3) fallback final: melhor (0)
  if(!chosen) chosen = ranked[0];

  const pick = chosen.n;
  usedSet.add(pick);
  if(cur) _applyToCur(pick, cur);
  return pick;
}


function _variantIndexByKind(kind){
  // 0..3 = varia√ß√µes do MESMO treino (sem inverter regras do perfil)
  // principal=0, invertida=1, tecnica1=2, tecnica2=3
  if(kind === "invertida") return 1;
  if(kind === "tecnica1") return 2;
  if(kind === "tecnica2") return 3;
  return 0;
}


// ===============================
// ‚úÖ Templates de CONJUNTO (aprendido no treino)
// - captura padr√µes recorrentes do TREINO (distribui√ß√£o de blocos e paridade)
// - usado para variar os 4 jogos sem sair do que foi aprendido
// ===============================
function _sigFromJogo(nums){
  const b = {A:0,B:0,C:0,D:0,E:0};
  let pares=0, impares=0;
  for(const n of (nums||[])){
    const x = Number(n);
    if(x>=1 && x<=5) b.A++; else if(x<=10) b.B++; else if(x<=15) b.C++; else if(x<=20) b.D++; else if(x<=25) b.E++;
    if(x%2===0) pares++; else impares++;
  }
  return { b, pares, impares };
}

function _topKTemplatesFromTrain(trainDraws, k=4){
  const map = Object.create(null);
  for(const a of (trainDraws||[])){
    if(!Array.isArray(a) || a.length!==15) continue;
    const sig = _sigFromJogo(a);
    const key = `A${sig.b.A}B${sig.b.B}C${sig.b.C}D${sig.b.D}E${sig.b.E}_P${sig.pares}I${sig.impares}`;
    map[key] = (map[key]||0) + 1;
  }
  const arr = Object.entries(map).map(([key,c])=>({key,c}));
  arr.sort((x,y)=> y.c - x.c || (x.key<y.key?-1:1));
  const out = [];
  for(const it of arr.slice(0, Math.max(1, k))){
    // parse key
    const m = /A(\d+)B(\d+)C(\d+)D(\d+)E(\d+)_P(\d+)I(\d+)/.exec(it.key);
    if(!m) continue;
    out.push({
      count: it.c,
      blocks: {A:+m[1],B:+m[2],C:+m[3],D:+m[4],E:+m[5]},
      pares: +m[6],
      impares: +m[7]
    });
  }
  return out.length ? out : [{count:1, blocks:{A:3,B:3,C:3,D:3,E:3}, pares:7, impares:8}];
}


/* =========================================================
   MOTOR PRINCIPAL (REENCENA√á√ÉO DO TREINO) ‚Äî V2
   - SEM "templates" de bloco/paridade/estrutura.
   - Aprende, a partir do TREINO, quais distribui√ß√µes (R/G2/G3/G4/F) mais se repetem
     quando olhamos o sorteio-alvo t e seus 4 anteriores.
   - Aprende tamb√©m pesos de transi√ß√£o por lag (1..4): "se estava no prev k, qual chance
     de aparecer no pr√≥ximo?" (estimado no treino).
   - Na gera√ß√£o, pega os 4 √∫ltimos concursos (prev4) e:
       1) escolhe 4 padr√µes fixos (top do treino)
       2) encaixa dezenas por categoria seguindo o score aprendido (determin√≠stico)
   ========================================================= */

/* TREINO (3578..3614) ‚Äî conforme lista enviada pelo usu√°rio */
const __TRAIN_PRINCIPAL_DRAWS = [
  [2,3,4,5,6,7,9,10,14,17,19,20,22,23,24], // 3578
  [1,2,3,4,8,10,11,13,15,17,19,20,21,23,25], // 3579
  [1,4,5,6,8,9,12,13,15,16,19,20,21,23,25], // 3580
  [2,3,4,5,6,7,8,10,12,15,16,17,20,22,24], // 3581
  [2,5,6,7,8,9,10,11,12,13,16,18,23,24,25], // 3582
  [2,3,4,6,9,10,12,13,14,15,21,22,23,24,25], // 3583
  [1,2,4,7,8,9,13,15,16,17,18,20,21,23,25], // 3584
  [1,2,4,8,9,10,13,16,17,19,20,21,22,23,25], // 3585
  [1,2,6,10,11,12,13,14,15,17,18,21,22,24,25], // 3586
  [1,2,4,8,9,10,11,12,13,16,17,18,19,20,22], // 3587
  [3,5,7,8,9,11,14,15,16,17,19,21,22,23,24], // 3588
  [1,2,3,4,8,10,11,12,15,18,19,21,22,24,25], // 3589
  [4,6,8,10,11,12,13,15,16,17,19,20,21,22,23], // 3590
  [1,2,3,4,6,7,10,11,13,14,15,17,18,19,20], // 3591
  [1,4,5,6,7,9,12,13,17,18,20,21,22,23,25], // 3592
  [1,3,4,6,7,8,9,10,12,15,18,19,23,24,25], // 3593
  [1,2,4,5,7,8,9,11,14,15,18,20,21,23,24], // 3594
  [1,2,4,5,6,8,10,12,13,15,16,20,21,22,25], // 3595
  [1,2,3,4,5,6,7,8,14,15,16,18,20,21,22], // 3596
  [1,4,5,7,10,11,13,14,15,16,19,20,21,23,25], // 3597
  [1,3,4,5,6,7,8,9,11,16,18,21,22,23,24], // 3598
  [1,4,6,7,8,9,11,12,13,16,19,20,21,23,24], // 3599
  [3,4,5,6,7,8,9,11,12,16,17,20,21,22,25], // 3600
  [2,3,4,6,7,8,9,11,16,17,20,21,23,24,25], // 3601
  [1,2,3,4,5,6,8,9,15,18,19,20,22,23,24], // 3602
  [2,4,5,9,10,11,12,14,15,17,19,20,21,22,24], // 3603
  [1,2,3,6,7,8,11,13,15,16,19,21,22,23,24], // 3604
  [1,3,4,7,10,12,13,14,19,20,21,22,23,24,25], // 3605
  [2,3,6,7,9,11,12,14,15,17,19,20,21,23,24], // 3606
  [1,2,4,5,6,8,9,13,14,15,16,18,19,20,23], // 3607
  [2,5,6,8,9,11,14,16,17,18,19,20,22,23,25], // 3608
  [2,5,6,8,9,10,11,12,13,17,19,20,22,24,25], // 3609
  [1,3,5,7,8,10,13,14,17,20,21,22,23,24,25], // 3610
  [1,2,3,4,5,6,10,11,12,14,15,17,18,19,25], // 3611
  [4,6,8,9,11,14,15,16,17,18,19,20,21,22,25], // 3612
  [1,3,4,7,9,10,11,12,15,16,18,20,21,22,23], // 3613
  [2,4,5,6,9,10,11,12,14,15,16,17,20,23,25]  // 3614
].map(a=>a.slice().sort((x,y)=>x-y));

function __setsFromPrev4(prev4){
  const s1 = new Set(prev4[0]||[]);
  const s2 = new Set(prev4[1]||[]);
  const s3 = new Set(prev4[2]||[]);
  const s4 = new Set(prev4[3]||[]);
  return {s1,s2,s3,s4};
}

function __catFromPrevSets(n, sets){
  const {s1,s2,s3,s4} = sets;
  if(s1.has(n)) return "R";
  if(s2.has(n)) return "G2";
  if(s3.has(n)) return "G3";
  if(s4.has(n)) return "G4";
  return "F";
}

function __buildTrainStats(trainDraws){
  const freq = Array(26).fill(0);
  const lagHit = [null, Array(26).fill(0), Array(26).fill(0), Array(26).fill(0), Array(26).fill(0)];
  const lagSeen = [null, Array(26).fill(0), Array(26).fill(0), Array(26).fill(0), Array(26).fill(0)];
  const patternCounts = new Map();

  for(const d of trainDraws){
    for(const n of d) freq[n] += 1;
  }

  for(let t=4; t<trainDraws.length; t++){
    const target = trainDraws[t];
    const prev4 = [trainDraws[t-1], trainDraws[t-2], trainDraws[t-3], trainDraws[t-4]];
    const sets = __setsFromPrev4(prev4);

    // lag stats
    for(let k=1;k<=4;k++){
      const prev = prev4[k-1] || [];
      for(const n of prev){
        lagSeen[k][n] += 1;
      }
    }
    for(const n of target){
      for(let k=1;k<=4;k++){
        if((prev4[k-1]||[]).includes(n)) lagHit[k][n] += 1;
      }
    }

    // pattern (distribui√ß√£o por categoria)
    const cnt = {R:0,G2:0,G3:0,G4:0,F:0};
    for(const n of target){
      cnt[__catFromPrevSets(n, sets)]++;
    }
    const key = `R${cnt.R}-G2${cnt.G2}-G3${cnt.G3}-G4${cnt.G4}-F${cnt.F}`;
    patternCounts.set(key, (patternCounts.get(key)||0)+1);
  }

  // top patterns: por frequ√™ncia e por agressividade (mais R, menos F)
  const topPatterns = [...patternCounts.entries()]
    .map(([k,c])=>{
      const m = k.match(/R(\d+)-G2(\d+)-G3(\d+)-G4(\d+)-F(\d+)/);
      const R = +(m?.[1]||0), G2=+(m?.[2]||0), G3=+(m?.[3]||0), G4=+(m?.[4]||0), F=+(m?.[5]||0);
      const rank = (c*1000) + (R*15) - (F*20) + (G2*4) + (G3*2) + (G4*1);
      return {key:k, count:c, R,G2,G3,G4,F, rank};
    })
    .sort((a,b)=> b.rank - a.rank || b.count-a.count || b.R-a.R || a.F-b.F)
    .slice(0,5);

  // probs (com smoothing leve)
  function prob(k,n){
    const hit = lagHit[k][n] || 0;
    const seen = lagSeen[k][n] || 0;
    // Laplace smoothing: (hit+1)/(seen+2)
    return (hit + 1) / (seen + 2);
  }

  const maxF = Math.max(...freq.slice(1)) || 1;
  function base(n){ return (freq[n]||0) / maxF; }

  return {freq, base, prob, topPatterns};
}

const __TRAIN_STATS_PRINCIPAL = __buildTrainStats(__TRAIN_PRINCIPAL_DRAWS);

function __scoreNow(n, prev4, stats){
  const sets = __setsFromPrev4(prev4);
  const c = __catFromPrevSets(n, sets);
  const b = stats.base(n);

  // pesos por lag (agressivo no curto prazo)
  const w1=3.0, w2=2.2, w3=1.7, w4=1.25;
  let s = b;

  if(c==="R")  s += w1 * stats.prob(1,n);
  else if(c==="G2") s += w2 * stats.prob(2,n);
  else if(c==="G3") s += w3 * stats.prob(3,n);
  else if(c==="G4") s += w4 * stats.prob(4,n);
  else {
    // fora do prev4: usa s√≥ base (treino) com leve b√¥nus se costuma "voltar do nada"
    // estimado como 1 - m√©dia das probs de estar nos lags (quanto menos depende do prev, mais "surge").
    const indep = 1 - ((stats.prob(1,n)+stats.prob(2,n)+stats.prob(3,n)+stats.prob(4,n))/4);
    s += 0.35 * indep;
  }

  return s;
}

function __pickFromCategory(catName, need, prev4, stats, usedSet){
  const sets = __setsFromPrev4(prev4);
  const pool = [];
  for(let n=1;n<=25;n++){
    if(usedSet.has(n)) continue;
    if(__catFromPrevSets(n, sets) !== catName) continue;
    pool.push({n, s: __scoreNow(n, prev4, stats)});
  }
  pool.sort((a,b)=> b.s-a.s || a.n-b.n);

  const out = [];
  for(const it of pool){
    if(out.length>=need) break;
    out.push(it.n);
    usedSet.add(it.n);
  }
  return out;
}

function __pickF(need, prev4, stats, usedSet){
  const sets = __setsFromPrev4(prev4);
  const pool = [];
  for(let n=1;n<=25;n++){
    if(usedSet.has(n)) continue;
    if(__catFromPrevSets(n, sets) !== "F") continue;
    pool.push({n, s: __scoreNow(n, prev4, stats)});
  }
  pool.sort((a,b)=> b.s-a.s || a.n-b.n);

  const out = [];
  for(const it of pool){
    if(out.length>=need) break;
    out.push(it.n);
    usedSet.add(it.n);
  }
  return out;
}

function __buildGameFromPattern(pattern, prev4, stats, label){
  const used = new Set();
  const motivos = [];

  const cats = [
    ["R", pattern.R],
    ["G2", pattern.G2],
    ["G3", pattern.G3],
    ["G4", pattern.G4]
  ];

  const jogo = [];

  for(const [c, need] of cats){
    if(need<=0) continue;
    const picked = __pickFromCategory(c, need, prev4, stats, used);
    picked.forEach(n=>{
      jogo.push(n);
      motivos.push({dezena:n, texto:`Treino ${label}: encaixe ${c} (sinal prev)`});
    });
  }

  if(pattern.F>0){
    const pickedF = __pickF(pattern.F, prev4, stats, used);
    pickedF.forEach(n=>{
      jogo.push(n);
      motivos.push({dezena:n, texto:`Treino ${label}: encaixe F (fora do prev4)`});
    });
  }

  // seguran√ßa: completa se faltar por causa de pools curtos (determin√≠stico)
  if(jogo.length < 15){
    const sets = __setsFromPrev4(prev4);
    const order = ["R","G2","G3","G4","F"];
    for(const c of order){
      while(jogo.length<15){
        const picked = __pickFromCategory(c, 1, prev4, stats, used);
        if(!picked.length) break;
        const n = picked[0];
        jogo.push(n);
        motivos.push({dezena:n, texto:`Treino ${label}: completar (pool curto)`});
      }
    }
  }

  return {jogo: uniqSort15(jogo), motivos};
}

function buildPack4JogosPreditivo(payload){
  // Base real de gera√ß√£o: SEMPRE os √∫ltimos 4 do payload (o usu√°rio controla a janela via API),
  // mas o "aprendizado" vem do TREINO acima.
  const concursos = payload?.concursos || [];
  const draws = concursos
    .map(c=> getDezenas(c).slice().sort((a,b)=>a-b))
    .filter(a=>a.length===15);

  if(draws.length < 1){
    return {
      ok:false,
      err:"Sem concursos v√°lidos.",
      principal:[], invertida:[], tecnica1:[], tecnica2:[],
      motivos:{principal:[], invertida:[], tecnica1:[], tecnica2:[]},
      meta:{}
    };
  }

  const last = draws[draws.length-1];
  const prev4 = [last, last, last, last];
  for(let k=1; k<4 && (draws.length-1-k)>=0; k++){
    prev4[k] = draws[draws.length-1-k];
  }

  const patterns = (__TRAIN_STATS_PRINCIPAL.topPatterns || []).slice();
  // Se por algum motivo vier menos de 4, usamos defaults agressivos (mesma l√≥gica de categorias)
  const defaults = [
    {key:"DEFAULT1", R:9,G2:4,G3:2,G4:0,F:0},
    {key:"DEFAULT2", R:10,G2:3,G3:2,G4:0,F:0},
    {key:"DEFAULT3", R:9,G2:3,G3:2,G4:1,F:0},
    {key:"DEFAULT4", R:9,G2:4,G3:1,G4:0,F:1}
  ];
  while(patterns.length < 4) patterns.push(defaults[patterns.length]);

  const p1 = patterns[0], p2 = patterns[1], p3 = patterns[2], p4 = patterns[3];

  const g1 = __buildGameFromPattern(p1, prev4, __TRAIN_STATS_PRINCIPAL, "P1");
  const g2 = __buildGameFromPattern(p2, prev4, __TRAIN_STATS_PRINCIPAL, "P2");
  const g3 = __buildGameFromPattern(p3, prev4, __TRAIN_STATS_PRINCIPAL, "P3");
  const g4 = __buildGameFromPattern(p4, prev4, __TRAIN_STATS_PRINCIPAL, "P4");

  // meta √∫til p/ debug/explica√ß√£o (sem impor estrutura)
  const sets = __setsFromPrev4(prev4);
  const meta = {
    patternsTop5: (__TRAIN_STATS_PRINCIPAL.topPatterns||[]).map(p=>({key:p.key,count:p.count,R:p.R,G2:p.G2,G3:p.G3,G4:p.G4,F:p.F})),
    prev4: prev4.map(a=>a.slice()),
    catMap: (()=>{
      const m = {};
      for(let n=1;n<=25;n++) m[n] = __catFromPrevSets(n, sets);
      return m;
    })()
  };

  return {
    ok:true,
    principal: g1.jogo,
    invertida: g2.jogo,
    tecnica1: g3.jogo,
    tecnica2: g4.jogo,
    motivos:{
      principal: g1.motivos,
      invertida: g2.motivos,
      tecnica1: g3.motivos,
      tecnica2: g4.motivos
    },
    meta
  };
}


function enforceDifferent(games, minDiffs, seed){
    for(let i=0;i<games.length;i++){
      for(let j=0;j<i;j++){
        const min = minDiffs[games[i].id] && minDiffs[games[i].id][games[j].id] || 0;
        if(min<=0) continue;
        let tries = 0;
        while(diffCount(games[i].jogo, games[j].jogo) < min && tries < 25){
          tries++;
          const current = games[i].jogo.slice();
          const set = new Set(current);
          let candIn = null;
          for(let n=1;n<=25;n++){
            if(!set.has(n)){ candIn = n; break; }
          }
          if(candIn==null) break;
          const outIdx = (current.length-1) - (tries%3);
          const out = current[outIdx];
          current[outIdx] = candIn;
          games[i].jogo = uniqSort15(current);
          games[i].motivos.push({dezena:candIn, texto:"Ajuste anti-igualdade entre jogos"});
        }
      }
    }
  }


// >>> Instala o motor NOVO (Padr√µes Fixos) como gerador oficial
window.buildPack4JogosPreditivo = buildPack4JogosPreditivo;

})();
</script>

</body>
</html>
