<!DOCTYPE html>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1227">
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lotof√°cil Prime Analytics</title>

<style>
  :root{
    --bg1:#020617; --bg2:#0b1227;
    --card:#071023; --card2:#061028;
    --text:#e5e7eb; --muted:#94a3b8;
    --green:#22c55e; --green2:#16a34a;
    --yellow:#facc15; --blue:#38bdf8; --red:#fb7185;
    --stroke: rgba(255,255,255,.08);
    --stroke2: rgba(255,255,255,.12);
  }
  *{box-sizing:border-box;font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
  body{
    margin:0;color:var(--text);
    background:
      radial-gradient(800px 600px at 10% 10%, rgba(56,189,248,.12), transparent 50%),
      radial-gradient(800px 600px at 90% 10%, rgba(34,197,94,.12), transparent 50%),
      linear-gradient(135deg,var(--bg1),var(--bg2));
    min-height:100vh
  }

  .center{display:flex;align-items:center;justify-content:center;min-height:100vh;padding:18px}
  .wrap{max-width:1180px;margin:0 auto;padding:18px}
  .header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:14px}
  .title{font-size:22px;font-weight:950;margin:0;letter-spacing:.2px}
  .subtitle{margin:6px 0 0;color:var(--muted);font-size:13px;font-weight:650}
  .chip{
    display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;
    background:rgba(255,255,255,.05);border:1px solid var(--stroke);
    color:var(--muted);font-size:12px;font-weight:750;
  }

  .card{
    background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
    border:1px solid var(--stroke);
    border-radius:18px;padding:16px;
    box-shadow:0 18px 50px rgba(0,0,0,.35);
    margin-bottom:14px;
  }
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px;margin-top:12px}
  .box{
    background:rgba(255,255,255,.03);
    border:1px solid var(--stroke);
    border-radius:16px;padding:12px;
  }
  .box p{margin:0;color:var(--text);font-size:13px;line-height:1.45}
  .mini{color:var(--muted);font-size:12px;margin-top:8px;line-height:1.4}

  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end}
  .col{flex:1;min-width:240px}

  label{display:block;font-size:12px;color:var(--muted);font-weight:850;margin-bottom:6px}
  input, select{
    width:100%;padding:12px;border-radius:12px;border:1px solid var(--stroke2);
    background:#020617;color:var(--text);outline:none;
  }

  button{
    padding:12px 14px;border:none;border-radius:14px;
    background:linear-gradient(135deg,var(--green),var(--green2));
    color:#052e1b;font-weight:950;cursor:pointer;transition:.15s;
  }
  button:hover{filter:brightness(1.05);transform:translateY(-1px)}
  button.secondary{background:transparent;border:1px solid var(--stroke2);color:var(--text)}
  button.danger{background:linear-gradient(135deg,#fb7185,#ef4444);color:#2b0b0b}
  button:disabled{opacity:.55;cursor:not-allowed;transform:none}
  .btnFull{width:100%}

  .msg{
    margin-top:12px;padding:12px;border-radius:14px;
    background:rgba(56,189,248,.08);border:1px solid rgba(56,189,248,.18);
    color:#cdefff;font-size:13px;font-weight:750;display:none;
  }
  .msg.err{background:rgba(251,113,133,.10);border:1px solid rgba(251,113,133,.25);color:#ffd3da}

  .pill{display:inline-block;padding:6px 10px;border-radius:999px;font-size:12px;font-weight:950;margin-bottom:8px}
  .pill.hot{background:rgba(34,197,94,.15);color:var(--green);border:1px solid rgba(34,197,94,.25)}
  .pill.warm{background:rgba(250,204,21,.12);color:var(--yellow);border:1px solid rgba(250,204,21,.25)}
  .pill.cold{background:rgba(251,113,133,.12);color:var(--red);border:1px solid rgba(251,113,133,.25)}
  .pill.info{background:rgba(56,189,248,.10);color:var(--blue);border:1px solid rgba(56,189,248,.22)}
  .pill.rep{background:rgba(34,197,94,.10);color:#7CFFB0;border:1px solid rgba(34,197,94,.20)}

  .numbers{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin:10px 0 6px}
  .ball{
    width:44px;height:44px;border-radius:999px;display:flex;align-items:center;justify-content:center;
    background:rgba(34,197,94,.10);border:1px solid rgba(34,197,94,.20);
    color:#b7ffd2;font-weight:950;letter-spacing:.4px;
    box-shadow:0 12px 30px rgba(0,0,0,.35);
  }
  .range{text-align:center;color:var(--muted);font-size:13px;font-weight:750;margin:0 0 10px}

  .chartCard{
    margin-top:12px;
    background:rgba(255,255,255,.03);
    border:1px solid var(--stroke);
    border-radius:16px;
    padding:14px;
  }
  .chartTitle{display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:center}
  .chartTitle b{font-size:13px}
  .chartHint{color:var(--muted);font-size:12px;font-weight:850}
  .chartRow{display:flex;align-items:center;gap:10px;margin:10px 0}
  .chartLabel{width:90px;color:var(--text);font-weight:950}
  .chartBarWrap{flex:1;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.10);border-radius:999px;overflow:hidden;height:16px}
  .chartBar{height:100%;width:0%;background:linear-gradient(90deg,var(--blue),var(--green))}
  .chartVal{width:56px;text-align:right;color:var(--text);font-weight:950}

  .status{display:none;margin-top:10px;padding:12px;border-radius:14px;background:rgba(56,189,248,.08);
          border:1px solid rgba(56,189,248,.18);color:#cdefff;font-size:13px;font-weight:750;}
  .bar{height:10px;border-radius:999px;overflow:hidden;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.06);margin-top:10px}
  .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--blue),var(--green));transition:width .2s ease}

  .modalBack{display:none;position:fixed;inset:0;background:rgba(0,0,0,.60);backdrop-filter: blur(6px);
             align-items:center;justify-content:center;padding:16px;z-index:999}
  .modal{width:100%;max-width:980px;background:linear-gradient(180deg,var(--card),rgba(255,255,255,.02));
         border:1px solid rgba(255,255,255,.10);border-radius:18px;box-shadow:0 40px 120px rgba(0,0,0,.65);
         overflow:hidden}
  .modalHeader{display:flex;justify-content:space-between;align-items:center;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
  .modalHeader b{font-size:14px}
  .closeBtn{padding:8px 10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,.14);
            color:var(--text);cursor:pointer}
  .modalBody{padding:14px 16px}

  .table{width:100%;border-collapse:collapse;font-size:13px}
  .table th,.table td{padding:10px 8px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;vertical-align:top}
  .table th{color:var(--muted);font-weight:950;font-size:12px}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}

  .footerNote{text-align:center;color:var(--muted);font-size:11px;margin-top:10px}
</style>
</head>

<body>

<script>
/* =========================
   CONFIG (j√° com seu link)
========================= */
const APP_NAME = "LOTOF√ÅCIL PRIME ANALYTICS";
const BUY_LINK = "https://pay.hotmart.com/R104129385C?off=s9zvi5rw";

/* C√≥digo de ativa√ß√£o (coloque este c√≥digo na P√°gina de Obrigado da Hotmart) */
const ACTIVATION_CODE = "PRIME-2026";

/* Seu acesso master permanente */
const MASTER_EMAIL = "admin@lotofacilprime.com";
const MASTER_PASS  = "prime123";

/* Free: 1 gera√ß√£o por dispositivo */
const FREE_LIMIT_KEY = "lf_free_used_v1";
</script>

<!-- LOGIN -->
<div class="center" id="loginWrap">
  <div class="card" style="max-width:520px;width:100%">
    <div style="text-align:center">
      <div class="title" style="margin:0">üéØ <span id="appName1"></span></div>
      <div class="subtitle">Entre para acessar o painel. Premium libera tudo.</div>
    </div>

    <div style="margin-top:12px" class="row">
      <div class="col">
        <label>Email</label>
        <input id="email" type="email" placeholder="seuemail@gmail.com" />
      </div>
      <div class="col">
        <label>Senha</label>
        <input id="senha" type="password" placeholder="sua senha" />
      </div>
    </div>

    <button id="btnEntrar" class="btnFull" type="button">Entrar</button>

    <div id="msgOk" class="msg"></div>
    <div id="msgErr" class="msg err"></div>

    <div class="footerNote">
      Dica: use seu login master para testar o Premium. Depois voc√™ troca.
    </div>
  </div>
</div>

<!-- APP -->
<div class="wrap" id="app" style="display:none">
  <div class="header">
    <div>
      <div class="title">üéØ <span id="appName2"></span></div>
      <div class="subtitle">An√°lises detalhadas + gr√°ficos + justificativas das dezenas.</div>
    </div>
    <div class="chip" id="chipUser">üë§</div>
  </div>

  <!-- PREMIUM GATE -->
  <div class="card" id="premiumGate" style="display:none">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>
        <div style="font-weight:950;font-size:16px">üîí √Årea Premium</div>
        <div class="mini">
          Voc√™ pode testar <b>1 gera√ß√£o gr√°tis</b>. Depois, para gerar novamente, precisa Premium.
        </div>
      </div>
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="danger" id="btnComprar" type="button">Comprar Premium</button>
        <button class="secondary" id="btnJaComprei" type="button">J√° comprei</button>
        <button class="secondary" id="btnSair" type="button">Sair</button>
      </div>
    </div>
    <div class="mini" style="margin-top:10px">
      ‚úÖ Ap√≥s pagar, volte aqui e clique em <b>J√° comprei</b> para ativar.
    </div>
  </div>

  <!-- CONTROLS -->
  <div class="card">
    <div class="row">
      <div class="col">
        <label>Quantidade de concursos para an√°lise</label>
        <select id="qtdConcursos">
          <option value="5">√öltimos 5 concursos</option>
          <option value="10" selected>√öltimos 10 concursos</option>
          <option value="15">√öltimos 15 concursos</option>
          <option value="20">√öltimos 20 concursos</option>
          <option value="25">√öltimos 25 concursos</option>
          <option value="50">√öltimos 50 concursos</option>
          <option value="75">√öltimos 75 concursos</option>
          <option value="100">√öltimos 100 concursos</option>
        </select>
      </div>

      <div class="col">
        <label>Gerar jogo e an√°lises</label>
        <button id="btnGerar" type="button" class="btnFull">üìä Gerar Jogo + An√°lise Completa</button>
      </div>
    </div>

    <div id="status" class="status">
      <div id="statusText">Carregando‚Ä¶</div>
      <div class="bar"><div id="barFill"></div></div>
    </div>

    <div class="mini" style="margin-top:10px">
      Se alguma API bloquear o navegador, o sistema cai automaticamente no modo demonstra√ß√£o ‚Äî o painel e os gr√°ficos continuam.
    </div>
  </div>

  <!-- RESULT -->
  <div class="card" id="resultado">
    <div class="footerNote">Selecione a janela e clique em ‚ÄúGerar‚Äù.</div>
  </div>

  <div class="footerNote">Aviso: an√°lise estat√≠stica n√£o garante premia√ß√£o. Jogo respons√°vel ‚úÖ</div>
</div>

<!-- MODAL LISTA CONCURSOS -->
<div id="modalBack" class="modalBack">
  <div class="modal">
    <div class="modalHeader">
      <b>üìå Concursos analisados (datas + dezenas)</b>
      <button class="closeBtn" onclick="fecharModal()">Fechar</button>
    </div>
    <div class="modalBody">
      <div id="listaConcursos"></div>
    </div>
  </div>
</div>

<!-- MODAL GRAFICO BLOCOS -->
<div id="modalBlocosBack" class="modalBack">
  <div class="modal" style="max-width:560px">
    <div class="modalHeader">
      <b>üìä Gr√°fico de Blocos A‚ÄìE</b>
      <button class="closeBtn" onclick="fecharGraficoBlocos()">Fechar</button>
    </div>
    <div class="modalBody">
      <div id="graficoBlocosArea"></div>
      <div class="mini" style="margin-top:10px">
        Blocos: A(01‚Äì05), B(06‚Äì10), C(11‚Äì15), D(16‚Äì20), E(21‚Äì25).
      </div>
    </div>
  </div>
</div>

<!-- MODAL ATIVAR PREMIUM -->
<div id="modalAtivarBack" class="modalBack">
  <div class="modal" style="max-width:520px">
    <div class="modalHeader">
      <b>‚úÖ Ativar Premium</b>
      <button class="closeBtn" onclick="fecharAtivar()">Fechar</button>
    </div>
    <div class="modalBody">
      <div class="mini">
        Se voc√™ j√° pagou na Hotmart, cole aqui o <b>C√≥digo de Ativa√ß√£o</b> que aparece na p√°gina de obrigado.
      </div>
      <input id="codigoAtivacao" placeholder="Ex: PRIME-2026" style="margin-top:10px"/>
      <button type="button" style="margin-top:10px" onclick="ativarPremium()">Ativar</button>
      <div class="mini" style="margin-top:10px">
        Ainda n√£o comprou? Clique em <b>Comprar Premium</b>.
      </div>
    </div>
  </div>
</div>

<script>
/* =========================
   UI Helpers
========================= */
document.getElementById("appName1").textContent = APP_NAME;
document.getElementById("appName2").textContent = APP_NAME;

function showOk(t){ const a=document.getElementById("msgOk"); a.style.display="block"; a.textContent=t; document.getElementById("msgErr").style.display="none"; }
function showErr(t){ const a=document.getElementById("msgErr"); a.style.display="block"; a.textContent=t; document.getElementById("msgOk").style.display="none"; }

function setStatus(on, text){
  const st=document.getElementById("status");
  document.getElementById("statusText").textContent = text || "";
  st.style.display = on ? "block" : "none";
}
function setProgress(p){
  document.getElementById("barFill").style.width = Math.max(0, Math.min(100, p)) + "%";
}

function abrirModal(){ document.getElementById("modalBack").style.display="flex"; }
function fecharModal(){ document.getElementById("modalBack").style.display="none"; }
function fecharGraficoBlocos(){ document.getElementById("modalBlocosBack").style.display="none"; }

function abrirAtivar(){ document.getElementById("modalAtivarBack").style.display="flex"; }
function fecharAtivar(){ document.getElementById("modalAtivarBack").style.display="none"; }

/* =========================
   Login (sem backend)
========================= */
function setSession(email, premium){
  localStorage.setItem("lf_email", email);
  localStorage.setItem("lf_premium", premium ? "1":"0");
}
function clearSession(){
  localStorage.removeItem("lf_email");
  localStorage.removeItem("lf_premium");
}
function getSession(){
  return { email: localStorage.getItem("lf_email") || "", premium: localStorage.getItem("lf_premium")==="1" };
}
function isFreeUsed(){ return localStorage.getItem(FREE_LIMIT_KEY)==="1"; }
function markFreeUsed(){ localStorage.setItem(FREE_LIMIT_KEY,"1"); }

function abrirApp(){
  const s=getSession();
  document.getElementById("loginWrap").style.display="none";
  document.getElementById("app").style.display="block";

  document.getElementById("chipUser").textContent =
    (s.premium ? "üëë Premium: " : "üë§ Free: ") + (s.email || "visitante");

  document.getElementById("premiumGate").style.display = s.premium ? "none" : "block";
  document.getElementById("btnGerar").disabled = s.premium ? false : isFreeUsed();
}

function entrar(){
  const email=(document.getElementById("email").value||"").trim().toLowerCase();
  const senha=(document.getElementById("senha").value||"");

  if(!email || !senha){ showErr("Digite email e senha."); return; }

  if(email === MASTER_EMAIL.toLowerCase() && senha === MASTER_PASS){
    setSession(email, true);
    showOk("Bem-vindo! Premium liberado ‚úÖ");
    abrirApp();
    return;
  }

  setSession(email, false);
  showOk("Entrou no modo Free. Voc√™ pode gerar 1 vez gratuitamente.");
  abrirApp();
}

function sair(){
  clearSession();
  location.reload();
}

function comprarPremium(){
  window.open(BUY_LINK, "_blank");
}

function ativarPremium(){
  const code = (document.getElementById("codigoAtivacao").value || "").trim();
  if(!code){ alert("Digite o c√≥digo."); return; }
  if(code !== ACTIVATION_CODE){ alert("C√≥digo inv√°lido. Verifique e tente novamente."); return; }

  const s = getSession();
  setSession(s.email || "cliente@premium", true);
  alert("Premium ativado ‚úÖ");
  fecharAtivar();
  abrirApp();
}

/* Auto-abrir modal de ativa√ß√£o se voltar da Hotmart com ?hotmart=ok */
(function(){
  const p = new URLSearchParams(location.search);
  if(p.get("hotmart")==="ok"){
    const s=getSession();
    if(s.email){
      setTimeout(()=>abrirAtivar(), 500);
    }
  }
})();
</script>

<script>
/* =========================
   MOTOR DE AN√ÅLISES
========================= */
function format2(n){ return String(n).padStart(2,"0"); }
function toNum(d){ return Number(String(d).replace(/^0+/,"")) || Number(d); }
function sortNum(arr){ return arr.slice().sort((a,b)=>a-b); }

function calcularFrequencias(concursos){
  const freq={}; for(let i=1;i<=25;i++) freq[i]=0;
  concursos.forEach(c=>{
    (c.dezenas||[]).forEach(d=>{
      const n=toNum(d);
      if(n>=1 && n<=25) freq[n]+=1;
    });
  });
  return freq;
}
function ordenarPorFreq(freq){
  return Object.entries(freq).map(([k,v])=>({dez:Number(k), f:v})).sort((a,b)=>b.f-a.f);
}

function contarParesImpares(jogo){
  const pares = jogo.filter(n=>n%2===0).length;
  return {pares, impares: jogo.length - pares};
}
function somaDezenas(jogo){ return jogo.reduce((a,b)=>a+b,0); }

function contarSequencias(jogo){
  let maxLen=1, curLen=0, prev=null;
  const sorted = sortNum(jogo);
  for(const n of sorted){
    if(prev!==null && n===prev+1){ curLen++; }
    else { curLen=1; }
    if(curLen>maxLen) maxLen=curLen;
    prev=n;
  }
  return { temSequencia: maxLen>=2, maxLen };
}

function finaisMaisFreq(concursos){
  const fin={}; for(let i=0;i<=9;i++) fin[i]=0;
  concursos.forEach(c=>{
    c.dezenas.forEach(d=>{
      const n=toNum(d);
      fin[n%10]+=1;
    });
  });
  return fin;
}

function distribuicaoBlocos(jogo){
  const b={A:0,B:0,C:0,D:0,E:0};
  jogo.forEach(n=>{
    if(n>=1 && n<=5) b.A++;
    else if(n>=6 && n<=10) b.B++;
    else if(n>=11 && n<=15) b.C++;
    else if(n>=16 && n<=20) b.D++;
    else if(n>=21 && n<=25) b.E++;
  });
  return b;
}

function repetidasDoUltimo(jogo, ultimoDezenas){
  const setUlt = new Set((ultimoDezenas||[]).map(toNum));
  return sortNum(jogo.filter(n=>setUlt.has(n)));
}

function classificarDezenas(freq, jogo){
  const ord = ordenarPorFreq(freq);
  const rank={}; ord.forEach((x,i)=>rank[x.dez]=i+1);
  const hot=[], warm=[], cold=[];
  jogo.forEach(n=>{
    const r=rank[n]||999;
    if(r<=8) hot.push(n);
    else if(r<=17) warm.push(n);
    else cold.push(n);
  });
  return {hot:sortNum(hot), warm:sortNum(warm), cold:sortNum(cold), rank};
}

function gerarJogoForte(freq){
  const ord = ordenarPorFreq(freq);
  const hotPool = ord.slice(0,10).map(x=>x.dez);
  const warmPool = ord.slice(10,18).map(x=>x.dez);
  const coldPool = ord.slice(-7).map(x=>x.dez);

  function addFromPool(pool, count, set){
    const shuffled = pool.slice().sort(()=>Math.random()-0.5);
    let added=0;
    for(const n of shuffled){
      if(set.has(n)) continue;
      set.add(n);
      added++;
      if(added>=count) break;
    }
  }

  let best=null;

  for(let t=0;t<600;t++){
    const set=new Set();
    addFromPool(hotPool, 6, set);
    addFromPool(warmPool, 7, set);
    addFromPool(coldPool, 2, set);
    while(set.size<15) set.add(Math.floor(Math.random()*25)+1);

    const jogo = sortNum([...set]);
    const pi = contarParesImpares(jogo);
    const soma = somaDezenas(jogo);
    const blocos = distribuicaoBlocos(jogo);
    const seq = contarSequencias(jogo);

    let score=0;
    score += (pi.pares===7 || pi.pares===8) ? 25 : 0;
    score += (soma>=170 && soma<=230) ? 20 : 0;
    const maxBlock = Math.max(blocos.A,blocos.B,blocos.C,blocos.D,blocos.E);
    score += (maxBlock<=5) ? 20 : 0;
    score += (seq.maxLen<=4) ? 15 : 0;
    score += Math.min(20, Math.round(jogo.reduce((a,n)=>a+(freq[n]||0),0)/10));

    if(!best || score>best.score) best={jogo, score};
  }

  return best.jogo;
}

function explainDezena(n, ctx){
  const { freq, rank, totalConcursos, ultimoDezenas, finaisRank } = ctx;

  const f = freq[n] || 0;
  const r = rank[n] || 999;
  const rep = (ultimoDezenas||[]).map(toNum).includes(n);

  const fin = n % 10;
  const finPos = finaisRank.indexOf(fin) + 1;

  const bloco = (n<=5) ? "A(01‚Äì05)" : (n<=10) ? "B(06‚Äì10)" : (n<=15) ? "C(11‚Äì15)" : (n<=20) ? "D(16‚Äì20)" : "E(21‚Äì25)";

  const tags = [];
  if(r<=8) tags.push("üî• quente");
  else if(r<=17) tags.push("üå°Ô∏è morna");
  else tags.push("‚ùÑÔ∏è fria");
  if(rep) tags.push("üîÅ repetida do √∫ltimo");
  if(finPos<=3) tags.push("üéØ final forte");
  tags.push("üß© bloco " + bloco);

  const txt =
    `Frequ√™ncia: ${f}x em ${totalConcursos} concursos ‚Ä¢ Rank: #${r}. ` +
    (rep ? "Entrou por repeti√ß√£o do √∫ltimo concurso + consist√™ncia. " : "Entrou por consist√™ncia e composi√ß√£o equilibrada. ") +
    (finPos<=3 ? `Final (${fin}) est√° entre os mais frequentes no per√≠odo. ` : `Final (${fin}) est√° dentro da m√©dia do per√≠odo. `) +
    `Distribui√ß√£o por blocos: ${bloco}.`;

  return { tags, txt };
}

function renderTop10(freq, totalConcursos){
  const ord = ordenarPorFreq(freq).slice(0,10);
  const max = ord[0]?.f || 1;

  const bars = ord.map(x=>{
    const pct = Math.round((x.f/max)*100);
    return `
      <div class="chartRow">
        <div class="chartLabel">Dezena ${format2(x.dez)}</div>
        <div class="chartBarWrap"><div class="chartBar" style="width:${pct}%"></div></div>
        <div class="chartVal">${x.f}x</div>
      </div>
    `;
  }).join("");

  return `
    <div class="chartCard">
      <div class="chartTitle">
        <b>üìä Top 10 dezenas mais frequentes</b>
        <span class="chartHint">Base: ${totalConcursos} concursos</span>
      </div>
      <div class="mini">Barras maiores = dezenas que mais apareceram no per√≠odo analisado.</div>
      <div style="margin-top:10px">${bars}</div>
    </div>
  `;
}

function renderFinaisChart(fin){
  const arr = Object.entries(fin).map(([k,v])=>({k:Number(k), v})).sort((a,b)=>b.v-a.v);
  const max = arr[0]?.v || 1;
  const rows = arr.map(x=>{
    const pct = Math.round((x.v/max)*100);
    return `
      <div class="chartRow">
        <div class="chartLabel">Final ${x.k}</div>
        <div class="chartBarWrap"><div class="chartBar" style="width:${pct}%"></div></div>
        <div class="chartVal">${x.v}x</div>
      </div>
    `;
  }).join("");

  return `
    <div class="chartCard">
      <div class="chartTitle">
        <b>üèÅ Finais mais frequentes (0‚Äì9)</b>
        <span class="chartHint">Base: per√≠odo</span>
      </div>
      <div class="mini">Ajuda a compor dezenas com finais mais fortes no hist√≥rico recente.</div>
      <div style="margin-top:10px">${rows}</div>
    </div>
  `;
}

function renderListaConcursos(concursos){
  const rows = concursos.map(c=>{
    const dezenas = (c.dezenas||[]).map(d=>format2(toNum(d))).join(" - ");
    const data = c.data ? String(c.data) : "‚Äî";
    return `<tr>
      <td><b>${c.concurso}</b></td>
      <td>${data}</td>
      <td class="mono">${dezenas}</td>
    </tr>`;
  }).join("");

  return `
    <table class="table">
      <thead><tr><th>Concurso</th><th>Data</th><th>Dezenas</th></tr></thead>
      <tbody>${rows}</tbody>
    </table>
  `;
}

function abrirGraficoBlocos(blocos){
  const max = Math.max(blocos.A,blocos.B,blocos.C,blocos.D,blocos.E,1);
  function row(label, val){
    const pct = Math.round((val/max)*100);
    return `
      <div class="chartRow">
        <div class="chartLabel">${label}</div>
        <div class="chartBarWrap"><div class="chartBar" style="width:${pct}%"></div></div>
        <div class="chartVal">${val}</div>
      </div>`;
  }
  document.getElementById("graficoBlocosArea").innerHTML =
    row("A (01‚Äì05)", blocos.A) +
    row("B (06‚Äì10)", blocos.B) +
    row("C (11‚Äì15)", blocos.C) +
    row("D (16‚Äì20)", blocos.D) +
    row("E (21‚Äì25)", blocos.E);

  document.getElementById("modalBlocosBack").style.display="flex";
}

/* =========================
   Dados: tenta online, se falhar usa demo
========================= */
const SOURCES = [
  {
    name: "loteriascaixa-api (p√∫blico)",
    latest: "https://loteriascaixa-api.herokuapp.com/api/lotofacil/latest",
    byId: (n)=>`https://loteriascaixa-api.herokuapp.com/api/lotofacil/${n}`,
    adapt: (j)=>({ concurso:Number(j.concurso), data:j.data||"", dezenas:(j.dezenas||[]).map(String) })
  },
  {
    name: "api.guidi.dev.br (fallback)",
    latest: "https://api.guidi.dev.br/loteria/lotofacil/ultimo",
    byId: (n)=>`https://api.guidi.dev.br/loteria/lotofacil/${n}`,
    adapt: (j)=>({ concurso:Number(j.numero), data:j.dataApuracao||"", dezenas:(j.listaDezenas||[]).map(String) })
  }
];

async function tryFetchJson(url){
  const r = await fetch(url, { cache:"no-store" });
  if(!r.ok) throw new Error("HTTP "+r.status);
  return await r.json();
}

async function getOnlineConcursos(qtd){
  let lastErr=null;
  for(const src of SOURCES){
    try{
      const latestRaw = await tryFetchJson(src.latest);
      const latest = src.adapt(latestRaw);
      if(!latest.concurso || !latest.dezenas?.length) throw new Error("Resposta inv√°lida");

      const ultimo = latest.concurso;
      const inicio = Math.max(1, ultimo - qtd + 1);

      const concursos=[];
      for(let c=inicio;c<=ultimo;c++){
        const raw = await tryFetchJson(src.byId(c));
        concursos.push(src.adapt(raw));
      }
      return { mode:"online", source:src.name, latest, concursos, inicio, ultimo };
    }catch(e){
      lastErr=e;
    }
  }
  throw lastErr || new Error("Falha online");
}

function buildDemo(qtd){
  const ultimo = 3600;
  const inicio = ultimo - qtd + 1;
  const concursos=[];
  for(let c=inicio;c<=ultimo;c++){
    const dezenas=new Set();
    while(dezenas.size<15) dezenas.add(Math.floor(Math.random()*25)+1);
    concursos.push({ concurso:c, data:"‚Äî", dezenas:[...dezenas].map(n=>format2(n)) });
  }
  const latest = concursos[concursos.length-1];
  return { mode:"demo", source:"Demonstra√ß√£o (offline)", latest, concursos, inicio, ultimo };
}

let lastPayload=null;

async function gerar(){
  const s=getSession();
  const btn=document.getElementById("btnGerar");

  if(!s.premium && isFreeUsed()){
    alert("üîí Voc√™ j√° usou a gera√ß√£o gr√°tis. Para liberar, compre o Premium.");
    return;
  }

  const qtd = Number(document.getElementById("qtdConcursos").value);

  try{
    btn.disabled=true;
    setStatus(true,"Carregando concursos‚Ä¶");
    setProgress(12);

    let payload;
    try{
      setStatus(true,"Buscando concursos reais‚Ä¶");
      setProgress(20);
      payload = await getOnlineConcursos(qtd);
    }catch(e){
      payload = buildDemo(qtd);
    }

    setStatus(true,"Calculando frequ√™ncias e criando jogo forte‚Ä¶");
    setProgress(62);

    const freq = calcularFrequencias(payload.concursos);
    const jogo = gerarJogoForte(freq);
    const cls = classificarDezenas(freq, jogo);
    const pi = contarParesImpares(jogo);
    const soma = somaDezenas(jogo);
    const seq = contarSequencias(jogo);
    const blocos = distribuicaoBlocos(jogo);
    const reps = repetidasDoUltimo(jogo, payload.latest.dezenas);

    const fin = finaisMaisFreq(payload.concursos);
    const finaisRank = Object.entries(fin).sort((a,b)=>b[1]-a[1]).map(x=>Number(x[0]));

    const ctxExplain = {
      freq, rank: cls.rank, totalConcursos: payload.concursos.length,
      ultimoDezenas: payload.latest.dezenas,
      finaisRank
    };

    const resumoPares = (pi.pares===7||pi.pares===8)
      ? `Distribui√ß√£o ideal (${pi.pares} pares / ${pi.impares} √≠mpares).`
      : `Distribui√ß√£o fora do ideal (melhor: 7/8).`;

    const resumoSoma = (soma>=170 && soma<=230)
      ? `Soma ${soma} dentro da faixa estat√≠stica mais comum (evita extremos).`
      : `Soma ${soma} fora da faixa mais comum ‚Äî combina√ß√£o mais ‚Äúarriscada‚Äù.`;

    const resumoSeq = seq.temSequencia
      ? `Possui sequ√™ncia, m√°ximo de ${seq.maxLen} n√∫meros seguidos (controle de padr√£o).`
      : `Sem sequ√™ncia (padr√£o mais ‚Äúquebrado‚Äù).`;

    const maxBlock = Math.max(blocos.A,blocos.B,blocos.C,blocos.D,blocos.E);
    const resumoBlocos = (maxBlock<=5)
      ? `Blocos equilibrados (m√°x ${maxBlock} em um bloco).`
      : `Concentra√ß√£o alta em blocos (m√°x ${maxBlock}).`;

    const resumoRep = reps.length
      ? `${reps.length} repetidas do √∫ltimo concurso (${payload.latest.concurso}).`
      : `Sem repetidas do √∫ltimo concurso (${payload.latest.concurso}).`;

    const explainCards = jogo.map(n=>{
      const ex = explainDezena(n, ctxExplain);
      const tags = ex.tags.map(t=>`<span class="pill info" style="margin:0 6px 6px 0">${t}</span>`).join("");
      return `
        <div class="box">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
            <div class="pill info">‚úÖ Dezena ${format2(n)} ‚Äî motivo</div>
            <div style="font-weight:950;color:#b7ffd2">#${cls.rank[n] || "‚Äî"}</div>
          </div>
          <div style="margin-top:8px">${tags}</div>
          <p>${ex.txt}</p>
        </div>
      `;
    }).join("");

    setStatus(false,"");
    setProgress(0);

    if(!s.premium) markFreeUsed();
    if(!s.premium) document.getElementById("btnGerar").disabled = true;

    lastPayload = { ...payload, freq, jogo, blocos };

    const balls = jogo.map(n=>`<div class="ball">${format2(n)}</div>`).join("");

    document.getElementById("resultado").innerHTML = `
      <div class="numbers">${balls}</div>
      <div class="range">
        üìå Janela: <b>${payload.inicio}</b> a <b>${payload.ultimo}</b> (${payload.concursos.length} concursos) ‚Ä¢
        Fonte: <b>${payload.source}</b> ‚Ä¢ Modo: <b>${payload.mode.toUpperCase()}</b>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:8px">
        <button class="secondary" type="button" onclick="verConcursos()">üìÖ Ver concursos analisados (lista)</button>
        <button class="secondary" type="button" onclick="abrirGraficoBlocos(lastPayload.blocos)">üìä Ver gr√°fico de blocos</button>
      </div>

      <div class="grid">
        <div class="box">
          <div class="pill rep">üîÅ Repetidas do √∫ltimo</div>
          <p><b>${reps.length ? reps.map(format2).join(", ") : "Nenhuma"}</b></p>
          <div class="mini">${resumoRep}</div>
        </div>

        <div class="box">
          <div class="pill info">‚öñÔ∏è Pares x √çmpares</div>
          <p><b>${pi.pares}</b> pares ‚Ä¢ <b>${pi.impares}</b> √≠mpares</p>
          <div class="mini">${resumoPares}</div>
        </div>

        <div class="box">
          <div class="pill info">‚ûï Soma das dezenas</div>
          <p><b>${soma}</b></p>
          <div class="mini">${resumoSoma}</div>
        </div>

        <div class="box">
          <div class="pill info">üß© Distribui√ß√£o por blocos</div>
          <p>
            A(01‚Äì05): <b>${blocos.A}</b> ‚Ä¢
            B(06‚Äì10): <b>${blocos.B}</b> ‚Ä¢
            C(11‚Äì15): <b>${blocos.C}</b> ‚Ä¢
            D(16‚Äì20): <b>${blocos.D}</b> ‚Ä¢
            E(21‚Äì25): <b>${blocos.E}</b>
          </p>
          <div class="mini">${resumoBlocos}</div>
        </div>

        <div class="box">
          <div class="pill info">üîó Sequ√™ncias</div>
          <p><b>${seq.temSequencia ? "Sim" : "N√£o"}</b> ‚Ä¢ M√°x: <b>${seq.maxLen}</b></p>
          <div class="mini">${resumoSeq}</div>
        </div>

        <div class="box">
          <div class="pill hot">üî• Quentes</div>
          <p><b>${cls.hot.map(format2).join(", ") || "‚Äî"}</b></p>
          <div class="mini">Dezenas com maior frequ√™ncia (top do ranking).</div>
        </div>

        <div class="box">
          <div class="pill warm">üå°Ô∏è Mornas</div>
          <p><b>${cls.warm.map(format2).join(", ") || "‚Äî"}</b></p>
          <div class="mini">Dezenas ‚Äúmeio do ranking‚Äù para equil√≠brio.</div>
        </div>

        <div class="box">
          <div class="pill cold">‚ùÑÔ∏è Frias</div>
          <p><b>${cls.cold.map(format2).join(", ") || "‚Äî"}</b></p>
          <div class="mini">Dezenas menos frequentes (diversifica√ß√£o).</div>
        </div>
      </div>

      ${renderTop10(freq, payload.concursos.length)}
      ${renderFinaisChart(fin)}

      <div class="card" style="margin-top:14px">
        <div style="font-weight:950;font-size:16px">üéØ Por que cada dezena foi escolhida</div>
        <div class="mini">Explica√ß√£o individual baseada em frequ√™ncia, ranking, finais, repeti√ß√£o do √∫ltimo e equil√≠brio de blocos.</div>
        <div class="grid" style="margin-top:12px">
          ${explainCards}
        </div>
      </div>
    `;

  }catch(e){
    setStatus(false,"");
    setProgress(0);
    document.getElementById("resultado").innerHTML = `
      <div class="box">
        <div class="pill info">‚ö†Ô∏è Erro</div>
        <p>${String(e?.message || e)}</p>
        <div class="mini">Se APIs externas bloquearem o navegador, o app cai no modo demonstra√ß√£o automaticamente.</div>
      </div>
    `;
  }finally{
    btn.disabled=false;
  }
}

function verConcursos(){
  if(!lastPayload) return;
  document.getElementById("listaConcursos").innerHTML = renderListaConcursos(lastPayload.concursos);
  abrirModal();
}
</script>

<script>
/* =========================
   Eventos
========================= */
document.getElementById("btnEntrar").addEventListener("click", entrar);
document.getElementById("btnComprar").addEventListener("click", comprarPremium);
document.getElementById("btnJaComprei").addEventListener("click", abrirAtivar);
document.getElementById("btnSair").addEventListener("click", sair);
document.getElementById("btnGerar").addEventListener("click", gerar);

document.getElementById("modalBack").addEventListener("click", (e)=>{ if(e.target.id==="modalBack") fecharModal(); });
document.getElementById("modalBlocosBack").addEventListener("click", (e)=>{ if(e.target.id==="modalBlocosBack") fecharGraficoBlocos(); });

document.addEventListener("DOMContentLoaded", ()=>{
  const s=getSession();
  if(s.email) abrirApp();
});
</script>

</body>
</html>
