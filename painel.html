<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>teste — Painel do Dono</title>
<meta name="description" content="Painel do dono do society: agenda, horários fixos e exportação de página."/>
<style>
  :root{
    --text:#eef5ff; --muted:rgba(238,245,255,.72); --line:rgba(255,255,255,.12);
    --bg1:#040806; --bg2:#050b08; --green:#22c55e; --green2:#34d399; --radius:18px; --max:1120px;
    --shadow: 0 28px 120px rgba(0,0,0,.62);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;color:var(--text);font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    background:
      radial-gradient(900px 420px at 26% 0%, rgba(34,197,94,.16), transparent 60%),
      radial-gradient(820px 420px at 80% 10%, rgba(34,197,94,.10), transparent 55%),
      linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 100%);
  }
  a{color:inherit;text-decoration:none}
  .wrap{max-width:var(--max); margin:0 auto; padding:18px 16px 80px}
  .top{display:flex; align-items:center; justify-content:space-between; gap:12px; padding:14px 14px; border:1px solid var(--line);
    border-radius:999px; background: rgba(6,12,10,.65); backdrop-filter: blur(10px); position: sticky; top:12px; z-index:20}
  .brand{display:flex; align-items:center; gap:10px; font-weight:1000}
  .dot{width:10px;height:10px;border-radius:999px;background:var(--green);display:inline-block}
  .pill{font-size:12px; font-weight:900; color:rgba(238,245,255,.78); border:1px solid var(--line);
    padding:6px 10px; border-radius:999px; background: rgba(255,255,255,.03)}
  .btn{display:inline-flex; align-items:center; justify-content:center; gap:10px; padding:12px 14px; border-radius:14px; border:1px solid var(--line);
    background: rgba(255,255,255,.04); font-weight:950; cursor:pointer}
  .btn:hover{filter:brightness(1.08)}
  .btn.primary{border:0; color:#05120b; background: linear-gradient(135deg, var(--green2), var(--green))}
  .card{border:1px solid var(--line); border-radius:var(--radius); background: rgba(255,255,255,.03); padding:16px; box-shadow: var(--shadow)}
  h1{margin:14px 0 6px; font-size: clamp(24px, 3.4vw, 40px)}
  h2{margin:0 0 10px; font-size:18px}
  .muted{color:var(--muted); line-height:1.65}
  .grid2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
  @media(max-width:920px){.grid2{grid-template-columns:1fr}}
  .field{display:flex; flex-direction:column; gap:6px; margin-bottom:12px}
  label{font-size:12px; color:rgba(238,245,255,.72); font-weight:900; letter-spacing:.2px}
  input,select,textarea{width:100%; padding:12px 12px; border-radius:14px; border:1px solid var(--line);
    background: rgba(0,0,0,.30); color:var(--text); outline:none; font-weight:850}
  textarea{min-height:120px; resize:vertical}
  .hr{height:1px; background: rgba(255,255,255,.10); margin:14px 0}
  .badge{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid rgba(34,197,94,.35);
    background: rgba(34,197,94,.10); font-weight:1000; font-size:12px}
  .actions{display:flex; gap:10px; flex-wrap:wrap}
  .toast{position: fixed; left: 50%; transform: translateX(-50%); bottom: 18px; background: rgba(0,0,0,.78);
    border:1px solid rgba(255,255,255,.14); color: rgba(238,245,255,.90); padding: 12px 14px; border-radius: 14px;
    font-weight: 950; font-size: 13px; z-index: 9999; display:none; backdrop-filter: blur(10px);}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
</style>
</head>
<body>
<div class="wrap">
  <header class="top">
    <div class="brand"><span class="dot"></span><span>teste</span><span class="pill">Painel do Dono</span></div>
    <div class="actions">
      <a class="btn" href="index.html">Ver página</a>
      <button class="btn" id="btnLogout" type="button" style="display:none">Sair</button>
    </div>
  </header>

  <h1>Controle do seu society</h1>
  <div class="muted">Aqui você configura sua agenda e depois clica em <b>“Gerar index.html atualizado”</b> para baixar e subir no seu site. Assim, qualquer mudança é <b>responsabilidade do dono</b>.</div>

  <div class="hr"></div>

  <div id="loginView" class="card">
    <h2>Acesso</h2>
    <div class="muted">Login inicial: <span class="mono">teste@teste.com.br</span> / <span class="mono">123</span></div>
    <div class="hr"></div>
    <div class="grid2">
      <div>
        <div class="field">
          <label for="email">E-mail</label>
          <input id="email" type="email" placeholder="seu e-mail">
        </div>
      </div>
      <div>
        <div class="field">
          <label for="pass">Senha</label>
          <input id="pass" type="password" placeholder="sua senha">
        </div>
      </div>
    </div>
    <div class="actions">
      <button class="btn primary" id="btnLogin" type="button">Entrar</button>
      <button class="btn" id="btnOpenPwd" type="button">Alterar senha</button>
    </div>

    <div id="pwdBox" style="display:none;margin-top:14px">
      <div class="hr"></div>
      <h2>Alterar senha</h2>
      <div class="grid2">
        <div class="field">
          <label for="oldp">Senha atual</label>
          <input id="oldp" type="password">
        </div>
        <div class="field">
          <label for="newp">Nova senha</label>
          <input id="newp" type="password" placeholder="mín. 6 caracteres">
        </div>
      </div>
      <div class="actions">
        <button class="btn primary" id="btnSavePwd" type="button">Salvar nova senha</button>
      </div>
    </div>
  </div>

  <div id="appView" style="display:none">
    <div class="card">
      <div class="actions" style="justify-content:space-between">
        <div class="badge">Agenda</div>
        <button class="btn primary" id="btnExport" type="button">Gerar index.html atualizado</button>
      </div>
      <div class="muted" style="margin-top:10px">
        Configure seus dias/horários. Quando terminar, gere o arquivo e suba no site.
      </div>
      <div class="hr"></div>

      <div class="grid2">
        <div>
          <h2>Horário de trabalho</h2>
          <div class="field">
            <label for="dias">Dias de trabalho</label>
            <select id="dias" multiple size="7">
              <option value="1">Segunda</option>
              <option value="2">Terça</option>
              <option value="3">Quarta</option>
              <option value="4">Quinta</option>
              <option value="5">Sexta</option>
              <option value="6">Sábado</option>
              <option value="0">Domingo</option>
            </select>
            <div class="muted" style="font-size:12px">Segure Ctrl (ou toque) para selecionar múltiplos.</div>
          </div>
          <div class="grid2">
            <div class="field">
              <label for="ini">Início</label>
              <input id="ini" type="time" value="18:00">
            </div>
            <div class="field">
              <label for="fim">Fim</label>
              <input id="fim" type="time" value="23:00">
            </div>
          </div>
          <div class="grid2">
            <div class="field">
              <label for="slot">Intervalo padrão</label>
              <select id="slot">
                <option value="60">60 min</option>
                <option value="90">90 min</option>
                <option value="120">120 min</option>
              </select>
            </div>
            <div class="field">
              <label for="valor">Valor padrão (R$)</label>
              <input id="valor" type="number" step="0.01" value="120.00">
            </div>
          </div>
        </div>

        <div>
          <h2>Agenda fixa</h2>
          <div class="muted" style="margin-bottom:10px">Cadastre aqui horários <b>fixos</b> (mensalistas). Eles ficam bloqueados no site até você remover.</div>
          <div class="field">
            <label for="fixoNome">Nome do cliente</label>
            <input id="fixoNome" type="text" placeholder="Ex: João (mensalista)">
          </div>
          <div class="grid2">
            <div class="field">
              <label for="fixoDia">Dia (0=Dom, 1=Seg...)</label>
              <input id="fixoDia" type="number" min="0" max="6" value="6">
            </div>
            <div class="field">
              <label for="fixoHora">Horário (HH:MM)</label>
              <input id="fixoHora" type="time" value="19:00">
            </div>
          </div>
          <div class="actions">
            <button class="btn" id="btnAddFixo" type="button">Adicionar fixo</button>
            <button class="btn" id="btnClearFixos" type="button">Limpar fixos</button>
          </div>
          <div class="hr"></div>
          <textarea id="fixosView" class="mono" readonly></textarea>
        </div>
      </div>
    </div>

    <div class="card" style="margin-top:14px">
      <h2>Observação importante</h2>
      <div class="muted">
        Para refletir mudanças no seu site, você precisa <b>gerar o index.html atualizado</b> e substituir o arquivo no servidor.
        Isso reduz responsabilidade da plataforma: <b>mudou aqui → você publica</b>.
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>
<script>
window.__AGC_SOC_NAME = "teste";
(function(){
  const LS_AUTH = "agc_owner_auth_v1";
  const LS_DATA = "agc_owner_data_v1";

  const $ = (id)=>document.getElementById(id);
  const toast = (msg)=>{
    const el = $("toast");
    el.textContent = msg;
    el.style.display = "block";
    clearTimeout(window.__t);
    window.__t = setTimeout(()=> el.style.display="none", 2200);
  };
  const dl = (filename, content)=>{
    const blob = new Blob([content], {type:"text/html;charset=utf-8"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 0);
  };

  const defaultAuth = { email: String("teste@teste.com.br").trim().toLowerCase(), pass: String("123") };
  const defaultData = { dias:["6"], ini:"18:00", fim:"23:00", slot:60, valor:"120.00", fixos:[] };

  function loadAuth(){
    const raw = localStorage.getItem(LS_AUTH);
    if(!raw){ localStorage.setItem(LS_AUTH, JSON.stringify(defaultAuth)); return {...defaultAuth}; }
    try { return JSON.parse(raw) || {...defaultAuth}; } catch(e){ return {...defaultAuth}; }
  }
  function saveAuth(a){ localStorage.setItem(LS_AUTH, JSON.stringify(a)); }

  function loadData(){
    const raw = localStorage.getItem(LS_DATA);
    if(!raw){ localStorage.setItem(LS_DATA, JSON.stringify(defaultData)); return structuredClone(defaultData); }
    try { return JSON.parse(raw) || structuredClone(defaultData); } catch(e){ return structuredClone(defaultData); }
  }
  function saveData(d){ localStorage.setItem(LS_DATA, JSON.stringify(d)); }

  let AUTH = loadAuth();
  let DATA = loadData();

  function setLogged(on){
    $("loginView").style.display = on ? "none" : "block";
    $("appView").style.display = on ? "block" : "none";
    $("btnLogout").style.display = on ? "inline-flex" : "none";
  }

  function refresh(){
    DATA = loadData();
    // dias
    const sel = $("dias");
    Array.from(sel.options).forEach(o=> o.selected = (DATA.dias||[]).includes(o.value));
    $("ini").value = DATA.ini || "18:00";
    $("fim").value = DATA.fim || "23:00";
    $("slot").value = String(DATA.slot || 60);
    $("valor").value = DATA.valor || "120.00";
    $("fixosView").value = JSON.stringify(DATA.fixos || [], null, 2);
  }

  function doLogin(){
    const email = ($("email").value||"").trim().toLowerCase();
    const pass  = $("pass").value||"";
    AUTH = loadAuth();
    if(email === (AUTH.email||"").toLowerCase() && pass === AUTH.pass){
      sessionStorage.setItem("agc_owner_logged","1");
      setLogged(true);
      refresh();
      toast("Bem-vindo!");
    }else{
      toast("Login inválido.");
    }
  }

  function doLogout(){
    sessionStorage.removeItem("agc_owner_logged");
    setLogged(false);
    toast("Você saiu.");
  }

  function togglePwd(){
    const box = $("pwdBox");
    box.style.display = (box.style.display==="none" || !box.style.display) ? "block" : "none";
  }

  function savePwd(){
    const oldp = $("oldp").value||"";
    const newp = $("newp").value||"";
    AUTH = loadAuth();
    if(oldp !== AUTH.pass){ toast("Senha atual incorreta."); return; }
    if(newp.length < 6){ toast("Nova senha deve ter 6+ caracteres."); return; }
    saveAuth({email: AUTH.email, pass:newp});
    $("oldp").value=""; $("newp").value="";
    toast("Senha alterada.");
  }

  function saveAgendaFromInputs(){
    const diasSel = Array.from($("dias").selectedOptions).map(o=>o.value);
    DATA.dias = diasSel;
    DATA.ini = $("ini").value;
    DATA.fim = $("fim").value;
    DATA.slot = Number($("slot").value||60);
    DATA.valor = $("valor").value;
    saveData(DATA);
  }

  function addFixo(){
    saveAgendaFromInputs();
    const nome = ($("fixoNome").value||"").trim();
    const dia = Number($("fixoDia").value||0);
    const hora = $("fixoHora").value || "00:00";
    if(!nome){ toast("Informe o nome."); return; }
    DATA.fixos = DATA.fixos || [];
    DATA.fixos.push({nome, dia, hora, tipo:"fixo"});
    saveData(DATA);
    $("fixoNome").value="";
    refresh();
    toast("Fixo adicionado.");
  }

  function clearFixos(){
    if(!confirm("Limpar todos os fixos?")) return;
    DATA.fixos = [];
    saveData(DATA);
    refresh();
    toast("Fixos limpos.");
  }

  // Export: aqui é a parte "sem responsabilidade": o dono gera e publica
  function exportIndex(){
    saveAgendaFromInputs();
    // A página index.html do cliente vai carregar este JSON e exibir horários com base nele (fase 1).
    const agendaJson = JSON.stringify(loadData());
    const injected = "
<script>
window.__AGC_OWNER_DATA = " + agendaJson + ";
</" + "script>";

    // O dono substitui o index.html no servidor. (Para manter simples: injetamos o JSON no topo do index atual)
    // Aqui a gente apenas avisa: você vai colar/colocar essa parte se quiser — na próxima etapa ligamos 100% ao agendamento real.
    const esc = (s)=>String(s).replace(/</g,"&lt;");
    const content = "<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">" + "<title>" + (window.__AGC_SOC_NAME||"Atualização") + " — Atualização</title></head>
" + "<body style="font-family:system-ui;padding:18px">
" + "<h2>Arquivo de atualização gerado</h2>
" + "<p>Este é um passo provisório: na próxima etapa, o painel vai gerar o <b>index.html completo</b> já com sua agenda integrada.</p>
" + "<p><b>JSON da agenda (já pronto):</b></p>
" + "<pre style="white-space:pre-wrap;background:#111;color:#eee;padding:12px;border-radius:12px">" + esc(agendaJson) + "</pre>
" + "<p><b>Trecho para colocar no index.html (logo antes de </b><code>&lt;/head&gt;</code><b>):</b></p>
" + "<pre style="white-space:pre-wrap;background:#111;color:#eee;padding:12px;border-radius:12px">" + esc(injected) + "</pre>
" + "</body></html>";
    dl("ATUALIZACAO_AGENDA.html", content);
    toast("Arquivo gerado. Suba no servidor.");
  }

  // Events
  $("btnLogin").addEventListener("click", doLogin);
  $("btnLogout").addEventListener("click", doLogout);
  $("btnOpenPwd").addEventListener("click", togglePwd);
  $("btnSavePwd").addEventListener("click", savePwd);

  $("btnAddFixo").addEventListener("click", addFixo);
  $("btnClearFixos").addEventListener("click", clearFixos);
  $("btnExport").addEventListener("click", exportIndex);

  // Boot
  if(sessionStorage.getItem("agc_owner_logged")==="1"){ setLogged(true); refresh(); }
  else { setLogged(false); }

})();
</script>
</body>
</html>
